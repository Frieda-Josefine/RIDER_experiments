---
title: "RIDER Overview"
output:
  html_document:
    theme: sandstone
    toc: yes
    toc_depth: '1'
    df_print: paged

date: "2023-10-16"
---

This document provides an extensive overview of the RIDER experiment series. It contains visualisations along side with the main statistical tests we performed to investigate how (un)attention during **Working** **Memory** influences how well something sticks to **Long-term** **Memory**. In the following you find the results for *RIDER1*, *RIDER2a* and *RIDER3*.
<br>
<br>
<br>


```{r setup environment, include=FALSE,fig.dim = c(4, 2)}
knitr::opts_chunk$set(echo = TRUE)
# surpress warnings
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
#clean environment
rm(list = ls()) 

#Libraries
library(plyr) #Ssplitting, applying and combining Data
library(dplyr) # for general data manipulation
library(ggplot2) # for visualizations
library(purrr)#working with functions and vectors
library(stringr)#working with strings
library(purrr)# for plotting
library(tidyverse)#different aspects of data processing
library(reshape)# for general data manipulation
library(scico)#colour palettes fpr plotting
library("readxl")
library(circular)
library(Rmisc)
library(ggpubr)# for plotting
library(rstatix)#for stats
library(viridis)# for nice plotting colors
library(data.table)
library(BayesFactor)#for performing a Bayesian t-test
library(cowplot)#for plotting
library(ggstatsplot)
library(formatR)
library(PupillometryR)
library(sm)
library(hrbrthemes)#nice plotting
library(viridis)#nice plotting
library(gridExtra)
library(plotly)# intersczive plotting
 library(ggpubr)
`%notin%` <- Negate(`%in%`)
```

```{r loading data, include=FALSE}
# RIDER1 data
data_WM <- read.csv("/Users/born/Documents/Upside_down_task/client/public/raw_data/WM_data.csv",na.strings=c("","NA"))
data_LTM <- read.csv("/Users/born/Documents/Upside_down_task/client/public/raw_data/LTM_data.csv",na.strings=c("","NA"))

# RIDER2a data
data_WM_V2 <- read.csv("/Users/born/Documents/Upside_down_task/client/public/WM_data_V2.csv",na.strings=c("","NA"))
data_LTM_V2 <- read.csv("/Users/born/Documents/Upside_down_task/client/public/LTM_data_V2.csv",na.strings=c("","NA"))

# RIDER3 data
data_WM_V3 <- read.csv("/Users/born/Documents/RIDER3/client/public/data/WM_data_RIDER_3.csv",na.strings=c("","NA"))
data_LTM_V3 <- read.csv("/Users/born/Documents/RIDER3/client/public/data/LTM_data_RIDER_3.csv",na.strings=c("","NA"))


timeout_WM <- data_WM %>% filter(is.na(adjust_keys_t1.rt))



data_LTM_V3 <- data_LTM_V3[!(as.character(data_LTM_V3$timeout_ltm) == "1"), ]
```

```{r calculating accurcy RIDER1, include=FALSE}
#RIDER1 accuracy

# Group the data by participant and remove the first 6 trials for each participant (those where training trials)
data_WM <- data_WM %>%
  group_by(participant) %>%
  slice(7:n()) %>%
  ungroup()

# Identify the row indices that have been deleted
practice_trials <- data_WM %>%
  group_by(participant) %>%
  slice(1:6)


#calculating the correct fixed orientations for the 2-item trials:
#depending on whether the stimulus was presented in image 1 or image 2

data_WM$startOri1 <- as.character(data_WM$startOri1)

data_WM <- data_WM %>%
  rowwise() %>%
  mutate(fixedOri_t1 = ifelse((test1 == image1), startOri1,ifelse((test1 ==  image2),startOri2,NA)))


data_WM <- data_WM %>%
  rowwise() %>%
  mutate(fixedOri_t2 = ifelse((test2 == image1), startOri1,ifelse((test2 ==  image2),startOri2,NA)))


# calculate remainder of this_ori variable to adjust for cases that are beyond 360 degrees
data_WM <- data_WM %>% mutate(ori_t1_corrected = this_ori_t1 %% 360)#Modulus (Remainder from division)
data_WM <- data_WM %>% mutate(ori_t2_corrected = this_ori_t2 %% 360)#Modulus (Remainder from division)

data_WM$fixedOri_t1 <- as.numeric(data_WM$fixedOri_t1)
data_WM$fixedOri_t2 <- as.numeric(data_WM$fixedOri_t2)


# calculating accuracy for test 1 and test 2
# function

angdiff <- function(alpha_deg, beta_deg) {
  #The function assumes that the input angles alpha and beta are in radians.So, you will have to convert them to radians first:
  alpha_rad <- alpha_deg * pi / 180
  beta_rad <- beta_deg * pi / 180
  # Then, you calculate the difference in angles
  delta_rad <- alpha_rad - beta_rad
  # If your input angles alpha and beta are larger than 360°, the mod() function will correctly wrap them to the range of [-180,180] degrees interval.
  delta_rad <- (delta_rad + pi) %% (2*pi) - pi
  delta_deg <- delta_rad * 180 / pi
  #the function outputs both the angular difference in degrees and in radians
  return(list(delta_rad = delta_rad, delta_deg = delta_deg))
}

# accuracy in radians
data_WM$accuracy_t1_rad <- apply(data_WM[,c("this_ori_t1", "fixedOri_t1")], 1, function(x) angdiff(x[1], x[2])$delta_rad)
data_WM$accuracy_t2_rad <- apply(data_WM[,c("this_ori_t2", "fixedOri_t2")], 1, function(x) angdiff(x[1], x[2])$delta_rad)

# accuracy in degrees
data_WM$accuracy_t1 <- abs(apply(data_WM[,c("this_ori_t1", "fixedOri_t1")], 1, function(x) angdiff(x[1], x[2])$delta_deg))
data_WM$accuracy_t2 <- abs(apply(data_WM[,c("this_ori_t2", "fixedOri_t2")], 1, function(x) angdiff(x[1], x[2])$delta_deg))

# pivot longer (here for degrees, as I am plotting in degrees)
data_WM_long<- data_WM %>% pivot_longer(cols=c('accuracy_t1','accuracy_t2'),names_to='attention_condition',values_to='accuracy') 


# accuracy and trial types for LTM task 

data_LTM<-data_LTM[!(data_LTM$participant=='15'),]


data_LTM <- rbind.fill(data_LTM,data_WM[c("test1", "test2","participant","image1","image2")])

# defining the menemonic distance conditions

data_LTM <- data_LTM  %>%
    group_by(participant)%>%
    mutate(mnemonic_diss = case_when(ltm_image %in% test1 & ltm_trial == 'baseline' ~ "Baseline",
                                     ltm_image %in%  test1 & ltm_image %in%  image2  ~ "Image 2- Test 1",
                                     ltm_image %in%  test1 & ltm_image %in%  image1  ~ "Image 1- Test 1",
                                     ltm_image %in%  test2 & ltm_image %in%  image2 ~ "Image 2- Test 2",
                                     ltm_image %in%  test2 & ltm_image %in% image1 ~ "Image 1- Test 2",
                                     ltm_image %notin% test1 & ltm_image %notin% test2 ~ "Never tested"))

# defining the simple trial types (as broader experimental conditions)
data_LTM <- data_LTM %>%
  group_by(participant)%>%
  mutate(trial_type = case_when(ltm_image %in% test1 & ltm_trial == 'baseline' ~ "Baseline",
                                 ltm_image %in%  test1  ~   "Test 1",
                                 ltm_image %in%  test2  ~   "Test 2",
                                 ltm_image %notin% test1 & ltm_image %notin% test2 ~ "Never tested"))

# data_LTM <- data_LTM %>%
#   group_by(participant)%>%
#   mutate(image_presentation = case_when(ltm_image %in% test1 & ltm_trial == 'baseline' ~ "Baseline",
#                                  ltm_image %in%  image1  ~   "Image 1",
#                                  ltm_image %in%  image2  ~   "Image 2"))


data_LTM <- data_LTM %>%
  group_by(participant)%>%
  mutate(image_presentation = case_when(ltm_trial == 'baseline' ~ "Baseline",
                                 ltm_image %in%  test1 & ltm_image %in% image1  ~   "Img1-Test1",
                                 ltm_image %in%  test1 & ltm_image %in% image2  ~   "Img2-Test1",
                                 ltm_image %in%  test2 & ltm_image %in% image1  ~   "Img1-Test2",
                                 ltm_image %in%  test2 & ltm_image %in% image2  ~   "Img2-Test2",
                                 ltm_image %notin% test1 & ltm_image %notin% test2 & ltm_image %in% image1 ~ "Img1-NT",
                                 ltm_image %notin% test1 & ltm_image %notin% test2 & ltm_image %in% image2 ~ "Img2-NT"))






# calculate ltm accuracy
data_LTM <- data_LTM %>% mutate(ori_ltm = this_ori_ltm %% 360)#Modulus (Remainder from division)


# calculating accuracy for LTM test

data_LTM <- data_LTM %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm -fixedOri_ltm))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm -fixedOri_ltm))

data_LTM <- transform(data_LTM, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

data_LTM <- data_LTM %>% 
  rowwise() %>%
  mutate(angle_ltm = this_ori_ltm -fixedOri_ltm)

#remove extra WM rows again
data_LTM <- data_LTM[rowSums(is.na(data_LTM)) == 0|rowSums(is.na(data_LTM)) == 1| rowSums(is.na(data_LTM)) == 2|rowSums(is.na(data_LTM)) == 3|rowSums(is.na(data_LTM)) == 4,]

data_LTM$accuracy_ltm_rad <- (apply(data_LTM[,c("this_ori_ltm", "fixedOri_ltm")], 1, function(x) angdiff(x[1], x[2])$delta_rad))

# WM trial_type

# simple retrieval trial types
data_WM_long <- data_WM_long  %>% 
  mutate(trial_type_new = case_when(
    baselinePresent  == 1 ~ "Baseline",
    trial_type !="baseline" & attention_condition == "accuracy_t1"  ~ "Test 1",
    trial_type !="baseline" & attention_condition == "accuracy_t2" ~ "Test 2"))

# image presentation

# data_WM_long <- data_WM_long  %>% 
#   mutate(image_presentation = case_when(
#     baselinePresent  == 1 ~ "Baseline",
#     image1 == test1 & attention_condition == "accuracy_t1"  ~ "Image 1",
#     image1 == test2 & attention_condition == "accuracy_t2" ~ "Image 1",
#     image2 == test2 & attention_condition == "accuracy_t2" ~ "Image 2",
#     image2 == test1 & attention_condition == "accuracy_t1" ~ "Image 2"))

# mnemonic distance

data_WM_long <- data_WM_long  %>% 
  mutate(mnemonic_dis = case_when(
    baselinePresent  == 1 ~ "Baseline",
    image2 == test1 & attention_condition == "accuracy_t1"      ~ "Image 2-Test 1",
    image2 == test2 & attention_condition == "accuracy_t2" ~ "Image 2-Test 2",
    image1 == test1 & attention_condition == "accuracy_t1" ~ "Image 1-Test 1",
    image1 == test2 & attention_condition == "accuracy_t2" ~ "Image 1-Test 2"))


# image effect


data_WM_long <- data_WM_long  %>% 
  mutate(image_presentation = case_when(
    baselinePresent  == 1 ~ "Baseline",
    image1 == test1 & attention_condition == "accuracy_t1"  ~ "Img1-Test1",
    image1 == test2 & attention_condition == "accuracy_t2" ~ "Img1-Test2",
    image2 == test2 & attention_condition == "accuracy_t2" ~ "Img2-Test2",
    image2 == test1 & attention_condition == "accuracy_t1" ~ "Img2-Test1"))

# drop rows where we have no data
data_WM_long <-data_WM_long %>% drop_na(accuracy)

# one participant is excluded due to low performance (see detailed RIDER1 script for wilcoxon test)

data_WM_long<-data_WM_long[!(data_WM_long$participant=='15'),]



# remove trials where reaction times are extremely long (> 15s)

# extract adjust_keys_t2_numeric from adjust_keys_t2.rt
data_WM_long$adjust_keys_t2_numeric <- apply(data_WM_long, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["adjust_keys_t2.rt"])))

# extract adjust_keys_t1_numeric from adjust_keys_t1.rt
data_WM_long$adjust_keys_t1_numeric <- apply(data_WM_long, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["adjust_keys_t1.rt"])))


data_WM$adjust_keys_t2_numeric <- apply(data_WM, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["adjust_keys_t2.rt"])))

# extract adjust_keys_t1_numeric from adjust_keys_t1.rt
data_WM$adjust_keys_t1_numeric <- apply(data_WM, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["adjust_keys_t1.rt"])))

# count_above_15 <- data_WM %>%
#   filter(adjust_keys_t2_numeric >= 15 | adjust_keys_t1_numeric >= 15) %>%
#   nrow()
# total_participants <- 187
# trials_per_participant <- 60
# 
# # Calculate the average number of trials per participant
# average_trials_per_participant <- count_above_15 / total_participants
# 
# # Calculate the percentages
# average_percentage <- (average_trials_per_participant / trials_per_participant) * 100
# 
# # Calculate the minimum and maximum percentages
# min_percentage <- (0 / trials_per_participant) * 100
# max_percentage <- (4.76 / trials_per_participant) * 100
# 
# # Format the result
# result <- sprintf("%.2f%% of trials on average; min = %.2f%%, max = %.2f%%", 
#                   average_percentage, min_percentage, max_percentage)
# 
# cat(result)

# create a logical vector for filtering
filter_vec <- ((data_WM_long$adjust_keys_t2_numeric <= 15) | is.na(data_WM_long$adjust_keys_t2_numeric)) & ((data_WM_long$adjust_keys_t1_numeric <= 15) | is.na(data_WM_long$adjust_keys_t1_numeric))

# filter the data
data_WM_long <- data_WM_long[filter_vec,]

```


```{r pruning RIDER1, include=FALSE}

removed_trials <- read.csv("/Users/born/Documents/Upside_down_task/client/public/pruning_removed_trials/removed_trials.csv",na.strings=c("","NA"))
removed_trials2 <- read.csv("/Users/born/Documents/Upside_down_task/client/public/pruning_removed_trials/removed_trials2.csv",na.strings=c("","NA"))
#write.csv(removed_trials,"/Users/born/Documents/Upside_down_task/client/public/removed_trials.csv", row.names = FALSE)
objects <- removed_trials %>%
  group_by(participant,trial_type_new)%>%
  summarise(test1,test2)

objects<- objects %>% pivot_longer(cols=c('test1', 'test2'),names_to='Presentation',values_to='image1') 

objects <- objects %>%
  rowwise()%>%
  mutate(delete = case_when(trial_type_new == "Test 1" & Presentation == "test2"  ~ "delete",
                            trial_type_new == "Test 2" & Presentation == "test1"  ~ "delete",
                            trial_type_new == "Test 1" & Presentation == "test1"  ~ "no_delete",
                            trial_type_new == "Test 2" & Presentation == "test2"  ~ "no_delete",
                            trial_type_new == "Baseline" & Presentation == "test2"  ~ "delete",
                            trial_type_new == "Baseline" & Presentation == "test1"  ~ "no_delete"))

objects<-objects[(objects$delete== "no_delete"),]

# identification of ltm object pool that includes only pruned WM conditions (Test 1 and Test 2 is effected here)
data_LTM <- rbind.fill(data_LTM,objects[c("participant", "image1")])

data_LTM <- data_LTM %>%
  group_by(participant)%>%
  mutate(matching = case_when(ltm_image %in% image1  ~ "Match",
                              ltm_image %notin%  image1  ~   "NO_Match"))


data_LTM <- data_LTM[rowSums(is.na(data_LTM)) == 1|rowSums(is.na(data_LTM)) == 2|rowSums(is.na(data_LTM)) == 3|rowSums(is.na(data_LTM)) == 4,]

# delete all matching trials in ltm dataframe
data_LTM_pruned<-data_LTM[!(data_LTM$matching=="Match"),]

data_LTM$pruned <- "NO"
data_LTM_pruned$pruned <-"YES"


LTM <- rbind(data_LTM,data_LTM_pruned)
```


```{r WM Bias RIDER1, include=FALSE}
summary_stats_LTM_P <- summarySE(LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant","pruned"),na.rm = T)
summary_study_level_LTM_g <- summarySE(summary_stats_LTM_P, measurevar = "accuracy_ltm", groupvars = c("trial_type","pruned"),na.rm = T)


test_2_data2 <- subset(data_LTM, trial_type == "Test 2", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))
test_2_data_WM2 <- subset(data_WM_long, trial_type_new == "Test 2", select = c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected"))
test_2_data2 <- rbind.fill(test_2_data2,test_2_data_WM2[c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected")])

test2_trials2 <-split(test_2_data2,test_2_data2$participant)

for(df in 1:length(test2_trials2)) {
  test2_trials2[[df]]$alternative_memory2 <- sapply(test2_trials2[[df]]$ltm_image,function(x) test2_trials2[[df]]$ori_t2_corrected[grep(x,test2_trials2[[df]]$test2)[1]])
}

test_2_data2 <- rbindlist(test2_trials2)

test_2_data2 <- test_2_data2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory2))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory2))

test_2_data2 <- transform(test_2_data2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# extract data for WM bias in baseline over participants

test_baseline_data2 <- subset(data_LTM, trial_type == "Baseline", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))
data_baseline2 <- subset(data_WM_long, trial_type_new == "Baseline", select = c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected"))
test_baseline_data2 <- rbind.fill(test_baseline_data2,data_baseline2[c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected")])

baseline_trials2 <-split(test_baseline_data2,test_baseline_data2$participant)

for(df in 1:length(baseline_trials2)) {
  baseline_trials2[[df]]$alternative_memory2 <- sapply(baseline_trials2[[df]]$ltm_image,function(x) baseline_trials2[[df]]$ori_t1_corrected[grep(x,baseline_trials2[[df]]$test1)[1]])
}

baseline_trials2 <- rbindlist(baseline_trials2)

baseline_trials2 <- baseline_trials2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory2))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory2))

baseline_trials2 <- transform(baseline_trials2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# extract data for WM bias in Test 1 over participants

test_1_data2 <- subset(data_LTM, trial_type == "Test 1", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))
test_1_data_WM2 <- subset(data_WM_long, trial_type_new == "Test 1", select = c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected"))
test_1_data2 <- rbind.fill(test_1_data2,test_1_data_WM2[c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected")])

test1_trials2 <-split(test_1_data2,test_1_data2$participant)

for(df in 1:length(test1_trials2)) {
  test1_trials2[[df]]$alternative_memory2 <- sapply(test1_trials2[[df]]$ltm_image,function(x) test1_trials2[[df]]$ori_t1_corrected[grep(x,test1_trials2[[df]]$test1)[1]])
}

test_1_data2 <- rbindlist(test1_trials2)


test_1_data2 <- test_1_data2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory2))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory2))

test_1_data2 <- transform(test_1_data2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# add trials type 
test_1_data2$trial_type <- "Test 1"
test_2_data2$trial_type <- "Test 2"
baseline_trials2$trial_type <- "Baseline"


alternative_ltm2 <- rbind(test_1_data2,test_2_data2,baseline_trials2)

summary_stats_participant_WB <- summarySE(alternative_ltm2, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_WB <- summarySE(summary_stats_participant_WB, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)


```

```{r WM Bias RIDER1 pruned data, include=FALSE}
#summary_stats_LTM_P <- summarySE(LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant","pruned"),na.rm = T)
#summary_study_level_LTM_g <- summarySE(summary_stats_LTM_P, measurevar = "accuracy_ltm", groupvars = c("trial_type","pruned"),na.rm = T)


test_2_data2 <- subset(data_LTM_pruned, trial_type == "Test 2", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))
test_2_data_WM2 <- subset(data_WM_long, trial_type_new == "Test 2", select = c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected"))
test_2_data2 <- rbind.fill(test_2_data2,test_2_data_WM2[c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected")])

test2_trials2 <-split(test_2_data2,test_2_data2$participant)

for(df in 1:length(test2_trials2)) {
  test2_trials2[[df]]$alternative_memory2 <- sapply(test2_trials2[[df]]$ltm_image,function(x) test2_trials2[[df]]$ori_t2_corrected[grep(x,test2_trials2[[df]]$test2)[1]])
}

test_2_data2 <- rbindlist(test2_trials2)

test_2_data2 <- test_2_data2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory2))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory2))

test_2_data2 <- transform(test_2_data2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# extract data for WM bias in baseline over participants

test_baseline_data2 <- subset(data_LTM_pruned, trial_type == "Baseline", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))
data_baseline2 <- subset(data_WM_long, trial_type_new == "Baseline", select = c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected"))
test_baseline_data2 <- rbind.fill(test_baseline_data2,data_baseline2[c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected")])

baseline_trials2 <-split(test_baseline_data2,test_baseline_data2$participant)

for(df in 1:length(baseline_trials2)) {
  baseline_trials2[[df]]$alternative_memory2 <- sapply(baseline_trials2[[df]]$ltm_image,function(x) baseline_trials2[[df]]$ori_t1_corrected[grep(x,baseline_trials2[[df]]$test1)[1]])
}

baseline_trials2 <- rbindlist(baseline_trials2)

baseline_trials2 <- baseline_trials2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory2))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory2))

baseline_trials2 <- transform(baseline_trials2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# extract data for WM bias in Test 1 over participants

test_1_data2 <- subset(data_LTM_pruned, trial_type == "Test 1", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))
test_1_data_WM2 <- subset(data_WM_long, trial_type_new == "Test 1", select = c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected"))
test_1_data2 <- rbind.fill(test_1_data2,test_1_data_WM2[c("participant","test1","test2","ori_t1_corrected","ori_t2_corrected")])

test1_trials2 <-split(test_1_data2,test_1_data2$participant)

for(df in 1:length(test1_trials2)) {
  test1_trials2[[df]]$alternative_memory2 <- sapply(test1_trials2[[df]]$ltm_image,function(x) test1_trials2[[df]]$ori_t1_corrected[grep(x,test1_trials2[[df]]$test1)[1]])
}

test_1_data2 <- rbindlist(test1_trials2)


test_1_data2 <- test_1_data2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory2))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory2))

test_1_data2 <- transform(test_1_data2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# add trials type 
test_1_data2$trial_type <- "Test 1"
test_2_data2$trial_type <- "Test 2"
baseline_trials2$trial_type <- "Baseline"


alternative_ltm_p <- rbind(test_1_data2,test_2_data2,baseline_trials2)

summary_stats_participant_WB_p <- summarySE(alternative_ltm_p, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_WB_p <- summarySE(summary_stats_participant_WB_p, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)

summary_stats_participant_WB_p$WM_point <- "WM_report"


```



<h3 style="text-align: center; color: green;">**RIDER 1**</h3>

<br>
<br>

## Data Visualisation RIDER1
In the following you see the WM and LTM results for RIDER1. The dots represent the individual participant means. The grey lines the overall mean with standard error bar. The orange line in the LTM plot represents the "WM Bias".
On the left side you see the broader experiment conditions (Baseline, Test1, Test 2, (Never tested in LTM)). On the right side you see image effects, plotting if the image was shown as Image 1 or Image 2 in Test 1 vs. Test 2.

<br>
<br>
<br>

### WM accuracy

<br>
<br>

```{r RIDER1 WM accuracy, echo = FALSE,out.width="130%", fig.cap="<br><br>**Figure** **1**: shows the general trial types on the left and image presentation effects effets on the right"}

summary_stats_participant_trial_type <- summarySE(data_WM_long, measurevar = "accuracy", groupvars = c("trial_type_new","participant"),na.rm = T)
summary_study_level_trial_type <- summarySE(summary_stats_participant_trial_type, measurevar = "accuracy", groupvars = c("trial_type_new"),na.rm = T)
summary_study_level_trial_type$participant <- 1

# Convert 'participant' to a factor explicitly
summary_stats_participant_trial_type$participant <- factor(summary_stats_participant_trial_type$participant)
summary_study_level_trial_type$participant <- factor(summary_study_level_trial_type$participant)



WM_trial_type <- ggplot(data = summary_stats_participant_trial_type, aes(x = factor(trial_type_new), y = accuracy, fill = participant)) +geom_line(data = summary_stats_participant_trial_type, aes(group = participant, x = trial_type_new, y = accuracy),color = "grey", size = 0.3, alpha = 0.5)+
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "C") +
  theme_light()+
  geom_point(data = summary_study_level_trial_type, aes(x = trial_type_new, y = accuracy),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_trial_type, aes(x = trial_type_new, ymin = accuracy - se, ymax = accuracy + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_trial_type, aes(x = trial_type_new, group = 1), colour = "black", size = 0.5) +
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(70, -5)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("Angular difference (in °)\n\n") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type_new), y = accuracy, fill = factor(trial_type_new)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FFA500")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "red", fill=NA, size=1))



#WM_trial_type
# image presentation plot

summary_stats_participant_image_pres <- summarySE(data_WM_long, measurevar = "accuracy", groupvars = c("image_presentation","participant"),na.rm = T)
summary_study_level_image_pres <- summarySE(summary_stats_participant_image_pres, measurevar = "accuracy", groupvars = c("image_presentation"),na.rm = T)
summary_study_level_image_pres$participant <- 1


#summary_stats_participant_image_pres<-summary_stats_participant_image_pres[!(summary_stats_participant_image_pres$image_presentation=="Baseline"),]
#summary_study_level_image_pres<-summary_study_level_image_pres[!(summary_study_level_image_pres$image_presentation=="Baseline"),]


# Convert 'participant' to a factor explicitly
summary_stats_participant_image_pres$participant <- factor(summary_stats_participant_image_pres$participant)
summary_study_level_image_pres$participant <- factor(summary_study_level_image_pres$participant)

level_order12 = c('Baseline','Img1-Test1','Img2-Test1','Img1-Test2','Img2-Test2')

WM_image_pres <- ggplot(data = summary_stats_participant_image_pres, aes(x = factor(image_presentation, level =level_order12 ), y = accuracy, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "C") +
  theme_light()+
  geom_point(data = summary_study_level_image_pres, aes(x = image_presentation, y = accuracy),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_image_pres, aes(x = image_presentation, ymin = accuracy - se, ymax = accuracy + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_image_pres, aes(x = image_presentation, group = 1), colour = "grey", size = 0.5) +
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(70,-5)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(image_presentation), y = accuracy, fill = factor(image_presentation)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FFA500")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))



summary_stats_participant_image_pres <- summarySE(data_WM_long, measurevar = "accuracy", groupvars = c("mnemonic_dis","participant"),na.rm = T)
summary_study_level_image_pres <- summarySE(summary_stats_participant_image_pres, measurevar = "accuracy", groupvars = c("mnemonic_dis"),na.rm = T)
summary_study_level_image_pres$participant <- 1


summary_stats_participant_image_pres$participant <- factor(summary_stats_participant_image_pres$participant)
summary_study_level_image_pres$participant <- factor(summary_study_level_image_pres$participant)

level_order13 = c('Baseline','Image 2-Test 1','Image 1-Test 1','Image 2-Test 2','Image 1-Test 2')

WM_mnem_distance <- ggplot(data = summary_stats_participant_image_pres, aes(x = factor(mnemonic_dis, level =level_order13 ), y = accuracy, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "C") +
  theme_light()+
  geom_point(data = summary_study_level_image_pres, aes(x = mnemonic_dis, y = accuracy),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_image_pres, aes(x = mnemonic_dis, ymin = accuracy - se, ymax = accuracy + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_image_pres, aes(x = mnemonic_dis, group = 1), colour = "grey", size = 0.5) +
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(70,-5)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(mnemonic_dis), y = accuracy, fill = factor(mnemonic_dis)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FFA500")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))

# summary_stats_participant_image_pres<-summary_stats_participant_image_pres[!(summary_stats_participant_image_pres$mnemonic_dis=="Baseline"),]
# 
# level_order20 = c('Image 2-Test 1','Image 1-Test 1','Image 2-Test 2','Image 1-Test 2')

# ggplot(data = summary_stats_participant_image_pres, aes(x = factor(mnemonic_dis, level = level_order20), y = accuracy)) +
#   # individual points coloured by mnemonic distance
#   geom_point(aes(color = factor(mnemonic_dis), fill = factor(mnemonic_dis)), size = 1.7, alpha = 0.5, position = position_jitter(width = 0.06, height = 0), show.legend = FALSE) +
#   # mean points coloured by mnemonic distance
#   geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.4, colour = "grey") +
#   # smooth line
#   geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.1, colour = "brown") +
#   # violin plot
#   geom_flat_violin(aes(fill = factor(mnemonic_dis)), alpha = 0.5, position = position_nudge(x = 0.15)) +
#   # population mean dots
#   stat_summary(fun.data = mean_cl_normal, geom = "point", size = 3, shape = 21, fill = "brown", color = "black") +
#   # dashed line at y = 0
#   geom_hline(yintercept = 0.6840637, linetype = "dashed", color = "brown") +
#   # mean and SE line
#   geom_smooth(method = "glm", se = T, aes(group = 1), color = "brown", size = 1.5) +
#   scale_y_reverse()+
#   # axis labels and title
#   xlab("") +
#   ylab("Percentage correct\n\n") +
#   labs(title = "") +
#   # fill and color schemes
#   scale_fill_manual(values = c("#FFE0B2", "#DAA520","#FFF5EB","#FFD700"), name = "Mnemonic distance") +
#   scale_color_manual(values = c("#FFE0B2", "#DAA520","#FFF5EB","#FFD700"), name = "Mnemonic distance") + # set dots color to the same violin fill color # set smooth line and mean point color to orange shades
#   # theme settings
#   theme_minimal() +
#   theme(
#     plot.title = element_text(hjust = 0.5, size = 12),
#     legend.position = "none",
#     axis.text = element_text(size = 8),
#     axis.title = element_text(size = 8),
#     axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
#   )





ggarrange(WM_trial_type, WM_image_pres, WM_mnem_distance,
          labels = c("Exp. conditions", "Recency effect","Mnem. dis."),
          ncol = 3, nrow = 1, widths = c(0.8, 0.9,0.9))


```



### LTM accuracy

<br>
<br>

```{r RIDER1 LTM accuracy, echo = FALSE,out.width="130%", fig.cap="<br><br>**Figure** **2**: shows the general trial types on the left and image presentation effects effets on the right"}
data_LTM$adjust_keys_LTM.rt_numeric <- apply(data_LTM, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["adjust_keys_LTM.rt"])))

# create a logical vector for filtering
filter_vec <- (data_LTM$adjust_keys_LTM.rt_numeric <= 15)

# filter the data
data_LTM <- data_LTM[filter_vec,]

summary_stats_participant_LTM <- summarySE(data_LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_LTM <- summarySE(summary_stats_participant_LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)
summary_study_level_LTM$participant <- 1
summary_study_level_WB$participant <- 1

summary_stats_participant_LTM$participant <- factor(summary_stats_participant_LTM$participant)
summary_study_level_LTM$participant <- factor(summary_study_level_LTM$participant)
summary_study_level_WB$participant <- factor(summary_study_level_WB$participant)


level_order <- c('One-item prioritized', 'Two-item prioritized', 'Two-item deprioritized','Never tested')

summary_stats_participant_LTM$trial_type[summary_stats_participant_LTM$trial_type == 'Baseline'] <- "One-item prioritized"
summary_stats_participant_LTM$trial_type[summary_stats_participant_LTM$trial_type == 'Test 1'] <- "Two-item prioritized"
summary_stats_participant_LTM$trial_type[summary_stats_participant_LTM$trial_type == 'Test 2'] <- "Two-item deprioritized"

summary_study_level_LTM$trial_type[summary_study_level_LTM$trial_type == 'Baseline'] <- "One-item prioritized"
summary_study_level_LTM$trial_type[summary_study_level_LTM$trial_type == 'Test 1'] <- "Two-item prioritized"
summary_study_level_LTM$trial_type[summary_study_level_LTM$trial_type == 'Test 2'] <- "Two-item deprioritized"

summary_study_level_WB$trial_type[summary_study_level_WB$trial_type == 'Baseline'] <- "One-item prioritized"
summary_study_level_WB$trial_type[summary_study_level_WB$trial_type == 'Test 1'] <- "Two-item prioritized"
summary_study_level_WB$trial_type[summary_study_level_WB$trial_type == 'Test 2'] <- "Two-item deprioritized"



plot <- ggplot(data = summary_stats_participant_LTM, aes(x = factor(trial_type,level = level_order), y = accuracy_ltm, fill = participant)) +
  geom_line(data = summary_stats_participant_LTM,aes(group = participant, x = factor(trial_type,level = level_order), y = accuracy_ltm),color = "grey", size = 0.3, alpha = 0.5)+
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_light() +
  geom_point(data = summary_study_level_LTM, aes(x = trial_type, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_LTM, aes(x = trial_type, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_LTM, aes(x = trial_type, group = 1), colour = "black", size = 0.5) +
  ylim(c(115,0)) +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "Experimental condition"  # Add a new x-axis title at the bottom
  ) +
  ylab("Error (°)") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type), y = accuracy_ltm, fill = factor(trial_type)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#56B4E9")+geom_vline(xintercept=3.7)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 14),
    axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "grey", fill=NA, size=1))

## lets just check for the pruned means

pruned <- summarySE(data_LTM_pruned, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
pruned_mean <- summarySE(pruned, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)


plot <- plot +
  annotate("text", x = 0.5, y = -5, hjust = 0, vjust = 0,
           label = "grey = difference to presentation orientation", size = 3.5, color = "grey") +
  annotate("text", x = 0.5, y = -15, hjust = 0, vjust = 0,
           label = "orange = difference to WM report", size = 3.5, color = "orange")

# Add ylim to expand the y-axis range to include the annotations
plot <- plot + ylim(c(110,-17))


#plot


# Image effect subplot
summary_stats_participant_LTM_ip <- summarySE(data_LTM, measurevar = "accuracy_ltm", groupvars = c("image_presentation","participant"),na.rm = T)
summary_study_level_ip <- summarySE(summary_stats_participant_LTM_ip, measurevar = "accuracy_ltm", groupvars = c("image_presentation"),na.rm = T)

summary_study_level_ip$participant <- 1

#summary_stats_participant_LTM_ip<-summary_stats_participant_LTM_ip[!(summary_stats_participant_LTM_ip$image_presentation=="Baseline"),]
#summary_study_level_ip<-summary_study_level_ip[!(summary_study_level_ip$image_presentation=="Baseline"),]

summary_stats_participant_LTM_ip$participant <- factor(summary_stats_participant_LTM_ip$participant)
summary_study_level_ip$participant <- factor(summary_study_level_ip$participant)


level_order2 <- c('Baseline','Img1-Test1', 'Img2-Test1', 'Img1-Test2','Img2-Test2','Img1-NT','Img2-NT')


plot_ip <- ggplot(data = summary_stats_participant_LTM_ip, aes(x = factor(image_presentation,level = level_order2), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_light() +
  geom_point(data = summary_study_level_ip, aes(x = image_presentation, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_ip, aes(x = image_presentation, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_ip, aes(x = image_presentation, group = 1), colour = "grey", size = 0.5) +
  geom_line(data = summary_study_level_ip, aes(x = image_presentation, group = 1),  colour = "grey", size =0.6 )+
  scale_y_reverse()+
  ylim(c(115,0)) +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = ""  # Add a new x-axis title at the bottom
  ) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(image_presentation), y = accuracy_ltm, fill = factor(image_presentation)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FF7F50")+geom_vline(xintercept=5.7)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
  )



# mnemonic distance  subplot
summary_stats_participant_LTM_ip <- summarySE(data_LTM, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)
summary_study_level_ip <- summarySE(summary_stats_participant_LTM_ip, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss"),na.rm = T)

summary_study_level_ip$participant <- 1

summary_stats_participant_LTM_ip<-summary_stats_participant_LTM_ip[!(summary_stats_participant_LTM_ip$mnemonic_diss=="Never tested"),]
summary_study_level_ip<-summary_study_level_ip[!(summary_study_level_ip$mnemonic_diss=="Never tested"),]

summary_stats_participant_LTM_ip$participant <- factor(summary_stats_participant_LTM_ip$participant)
summary_study_level_ip$participant <- factor(summary_study_level_ip$participant)


level_order0 <- c('Baseline','Image 2- Test 1', 'Image 1- Test 1', 'Image 2- Test 2','Image 1- Test 2')


plot_ltm_mnemDIS <- ggplot(data = summary_stats_participant_LTM_ip, aes(x = factor(mnemonic_diss,level = level_order0), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_light() +
  geom_point(data = summary_study_level_ip, aes(x = mnemonic_diss, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_ip, aes(x = mnemonic_diss, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_ip, aes(x = mnemonic_diss, group = 1), colour = "grey", size = 0.5) +
  geom_line(data = summary_study_level_ip, aes(x = mnemonic_diss, group = 1),  colour = "grey", size =0.6 )+
   geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.1, colour = "brown")+
  scale_y_reverse()+
  ylim(c(115,0)) +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = ""  # Add a new x-axis title at the bottom
  ) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(mnemonic_diss), y = accuracy_ltm, fill = factor(mnemonic_diss)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FF7F50")+geom_vline(xintercept=5.7)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
  )


#plot_ip

ggarrange(plot, plot_ip, plot_ltm_mnemDIS,
          labels = c("Exp. conditions", "Primacy effect","Mnem. dis"),
          ncol = 3, nrow = 1, widths = c(0.8, 1,1))


#print("Here to check for mnemonic distance conditions in LTM --> correct axis labels with image 1 - test 2 yielding the highest performance")

#plot_ltm_mnemDIS
```

### Statistics
#### ANOVA experimental conditions and task
This section presents the results of an ANOVA analysis investigating the influence of experimental conditions and task types (WM vs. LTM) on accuracy. Significant main effects were found for both experimental condition and task type. Furthermore, a significant interaction effect indicating a nuanced relationship between experimental conditions and task type influencing participants' performance.
<br>


```{r Statistical analysis anova RIDER1, echo=FALSE}

data_LTM$task <- "LTM"
data_LTM_pruned$task <- "LTM"
data_WM_long$task <-"WM"

# here is quickly put the stats for the pruned vs. unpruned comparison
# pruned$pruning <- "Yes"
# summary_stats_participant_LTM$pruning <- "No"
# 
# pruned<-pruned[!(pruned$trial_type=="Never tested"),]
# summary_stats_participant_LTM<-summary_stats_participant_LTM[!(summary_stats_participant_LTM$trial_type=="Never tested"),]
# 
# full_data <- rbind(pruned, summary_stats_participant_LTM)
# 
# 
# full_data %>%
#   group_by(trial_type)%>%
#   pairwise_t_test(
#     accuracy_ltm ~ pruning, paired = TRUE,
#     p.adjust.method = "holm")
# 
# full_data<-full_data[!(full_data$participant=="39"),]
# full_data<-full_data[!(full_data$participant=="50"),]
# full_data<-full_data[!(full_data$participant=="81"),]
# full_data<-full_data[!(full_data$participant=="66"),]
# full_data<-full_data[!(full_data$participant=="178"),]
# full_data<-full_data[!(full_data$participant=="143"),]
# full_data<-full_data[!(full_data$participant=="118"),]
# full_data<-full_data[!(full_data$participant=="111"),]
# full_data<-full_data[!(full_data$participant=="96"),]
# full_data<-full_data[!(full_data$participant=="88"),]
# full_data<-full_data[!(full_data$participant=="119"),]
# full_data<-full_data[!(full_data$participant=="102"),]

data_subset <- data_LTM %>%
  select(accuracy_ltm, trial_type,participant,task)

data_subset_p <- data_LTM_pruned %>%
  select(accuracy_ltm, trial_type,participant,task)

data_subset_new <- data_LTM %>%
  select(accuracy_ltm, trial_type,image_presentation,participant,task)

data_subset_new_p <- data_LTM_pruned %>%
  select(accuracy_ltm, trial_type,image_presentation,participant,task)

data_subset_mnemonic_dis <- data_LTM %>%
  select(accuracy_ltm, mnemonic_diss,image_presentation,participant,task)

data_subset_mnemonic_dis_p <- data_LTM_pruned %>%
  select(accuracy_ltm, mnemonic_diss,image_presentation,participant,task)


data_subset_WM <- data_WM_long%>%
  select(accuracy, trial_type_new,participant,task)

data_subset_WM_new <- data_WM_long%>%
  select(accuracy, trial_type_new,image_presentation,participant,task)

data_subset_WM_mnemonic_dis <- data_WM_long%>%
  select(accuracy, mnemonic_dis,image_presentation,participant,task)

# data_subset_WM <- data_WM_long%>%
#   select(accuracy, trial_type_new,image_presentation,participant,test)

colnames(data_subset)[1] = "accuracy"
colnames(data_subset_WM)[2] = "exp_condition"
colnames(data_subset)[2] = "exp_condition"

colnames(data_subset_new)[1] = "accuracy"
colnames(data_subset_mnemonic_dis)[1] = "accuracy"
colnames(data_subset_mnemonic_dis)[2] = "mnemonic_dis"


colnames(data_subset_new)[1] = "accuracy"
colnames(data_subset_WM_new)[2] = "exp_condition"
colnames(data_subset_WM_new)[3] = "stimulus_presentation"
colnames(data_subset_new)[2] = "exp_condition"
colnames(data_subset_new)[3] = "stimulus_presentation"


colnames(data_subset_new)[1] = "accuracy"




full_data <- rbind(data_subset_WM, data_subset)

full_data_new <- rbind(data_subset_WM_new, data_subset_new)

full_data_mnem_dis <- rbind(data_subset_mnemonic_dis, data_subset_WM_mnemonic_dis)

full_data_new<-full_data_new[!(full_data_new$exp_condition=="Never tested"),]
full_data_new<-full_data_new[!(full_data_new$exp_condition=="Baseline"),]
full_data_new<-full_data_new[!(full_data_new$stimulus_presentation=="Never tested"),]
full_data_new<-full_data_new[!(full_data_new$stimulus_presentation=="Baseline"),]
full_data_new<-full_data_new[!(full_data_new$stimulus_presentation=="Baseline"),]

full_data_mnem_dis<-full_data_mnem_dis[!(full_data_mnem_dis$mnemonic_dis=="Never tested"),]

full_data<-full_data[!(full_data$exp_condition=="Never tested"),]
#full_data<-full_data[!(full_data$exp_condition=="Baseline"),]

full_data$participant = as.factor(full_data$participant)
full_data_new$participant = as.factor(full_data_new$participant)

full_data_summary <-full_data %>%
  group_by(task, exp_condition, participant) %>%
  get_summary_stats(accuracy, type = "mean_sd")

full_data_summary_new <-full_data_new %>%
  group_by(task, exp_condition, participant,stimulus_presentation) %>%
  get_summary_stats(accuracy, type = "mean_sd")

full_data_summary_mnem_dis <-full_data_mnem_dis %>%
  group_by(task, mnemonic_dis, participant) %>%
  get_summary_stats(accuracy, type = "mean_sd")


print("This 3 (baseline, test 1, test 2) x 2 (WM/ LTM) ANOVA displays the results of exp. conditions across the two tasks")

# res.aov2 <- with(full_data_summary,
#                  aov(mean ~ exp_condition * task+Error(participant)))
# 
# 
# summary(res.aov2,detailed = TRUE)


full_data_summary$exp_condition <- factor(full_data_summary$exp_condition)
full_data_summary$task <- factor(full_data_summary$task)

full_data_summary <- full_data_summary %>%
  mutate(exp_condition = recode(exp_condition, "Test 1" = "Test1", "Test 2" = "Test2"))

res.aov <- anova_test(data = full_data_summary, dv = mean, wid = participant, within = c(task, exp_condition))

get_anova_table(res.aov)

print("This 2 (sample 1/2) x 2 (WM / LTM) ANOVA incorporates also the effect of sample position across the two tasks.")


full_data_summary_new$exp_condition <- factor(full_data_summary_new$exp_condition)
full_data_summary_new$task <- factor(full_data_summary_new$task)
full_data_summary_new$stimulus_presentation <- factor(full_data_summary_new$stimulus_presentation)

full_data_summary_new <- full_data_summary_new %>%
  mutate(stimulus_presentation = recode(stimulus_presentation,"Img1-Test2" = "Img1Test2","Img2-Test2" = "Img2Test2", "Img1-Test1"= "Img1Test1","Img2-Test1"= "Img2Test1"))

full_data_summary_new <- full_data_summary_new %>%
  mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2"))


#res.aov3 <- with(full_data_summary_new,
                 #aov(mean ~ exp_condition * task * stimulus_presentation+Error(participant)))

res.aov <- anova_test(data = full_data_summary_new, dv = mean, wid = participant, within = c(task,stimulus_presentation))

get_anova_table(res.aov)

print("This 2  x 2 ANOVA focuses on the stimulus effects in the WM task (1/2 sample, 1/2 test)")

# Step 1: Filter rows based on stimulus_presentation

filtered_data <- data_subset_WM_new %>%
  filter(task %in% c("WM"))

filtered_data <- filtered_data %>%
  filter(stimulus_presentation %in% c("Img2-Test1", "Img1-Test1", "Img2-Test2", "Img1-Test2"))

# Step 2: Further filter rows based on exp_condition and task
filtered_data <- filtered_data %>%
  filter(exp_condition %in% c("Test 1", "Test 2"))

# Step 3: Rename variable levels
filtered_data <- filtered_data %>%
  mutate(stimulus_presentation = sub("-Test1$", "", stimulus_presentation),
         stimulus_presentation = sub("-Test2$", "", stimulus_presentation))


summary_image_pres <-filtered_data %>%
  group_by(exp_condition, participant,stimulus_presentation) %>%
  get_summary_stats(accuracy, type = "mean_sd")

summary_image_pres <- summary_image_pres %>%
  mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2"))

summary_image_pres$exp_condition <- factor(summary_image_pres$exp_condition)
summary_image_pres$stimulus_presentation <- factor(summary_image_pres$stimulus_presentation)

res.aov_image_presWM <- anova_test(data = summary_image_pres, dv = mean, wid = participant, within = c(stimulus_presentation,exp_condition))

get_anova_table(res.aov_image_presWM)

# ggplot(summary_image_pres, aes(x = stimulus_presentation, y = mean)) +
#   geom_bar(stat = "identity") +
#   labs(title = "stimulus_presentation",
#        x = "stimulus_presentation",
#        y = "accuracy") +
#   theme_minimal() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
#   facet_wrap(~exp_condition, ncol = 1)

image_effects <- summary_image_pres %>%
  group_by(exp_condition)%>%
  pairwise_t_test(
    mean ~ stimulus_presentation, paired = TRUE,
    p.adjust.method = "holm")

print("The following table shows the sample 1 /2 effects in WM Test 1 vs. Test 2 ")
image_effects


print("This 2 (sample 1/2) x 2 (Test 1 /2) x 2(WM/ LTM) ANOVA summarizes the sample and test effects from both tasks")

filtered_data2 <- full_data_new %>%
  filter(stimulus_presentation %in% c("Img2-Test1", "Img1-Test1", "Img2-Test2", "Img1-Test2"))

# Step 2: Further filter rows based on exp_condition and task
filtered_data2 <- filtered_data2 %>%
  filter(exp_condition %in% c("Test 1", "Test 2"))

# Step 3: Rename variable levels
filtered_data2 <- filtered_data2 %>%
  mutate(stimulus_presentation = sub("-Test1$", "", stimulus_presentation),
         stimulus_presentation = sub("-Test2$", "", stimulus_presentation))


summary_image_pres2 <-filtered_data2 %>%
  group_by(exp_condition, participant,stimulus_presentation, task) %>%
  get_summary_stats(accuracy, type = "mean_sd")

summary_image_pres2 <- summary_image_pres2 %>%
  mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2"))

summary_image_pres2$exp_condition <- factor(summary_image_pres2$exp_condition)
summary_image_pres2$stimulus_presentation <- factor(summary_image_pres2$stimulus_presentation)
summary_image_pres2$task <- factor(summary_image_pres2$task)

res.aov_image_presWM2 <- anova_test(data = summary_image_pres2, dv = mean, wid = participant, within = c(stimulus_presentation,exp_condition,task))

get_anova_table(res.aov_image_presWM2)


# ggplot(summary_image_pres2, aes(x = stimulus_presentation, y = mean)) +
#   geom_bar(stat = "identity") +
#   labs(title = "stimulus presentation effects over tasks and tests",
#        x = "stimulus_presentation",
#        y = "accuracy") +
#   theme_minimal() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
#   facet_wrap(~exp_condition + task, ncol = 2)



print("This 2 (1/2 sample) x 2 (1/2 test) ANOVA focuses on the sample effects in the LTM task")

# Step 1: Filter rows based on stimulus_presentation

data_subset_new<-data_subset_new[!(data_subset_new$exp_condition=="Baseline"),]

filtered_data3 <- data_subset_new %>%
  filter(stimulus_presentation %in% c("Img2-Test1", "Img1-Test1", "Img2-Test2", "Img1-Test2"))

# Step 3: Rename variable levels
# filtered_data3 <- data_subset_new %>%
#   mutate(stimulus_presentation = sub("-Test1$", "", stimulus_presentation),
#          stimulus_presentation = sub("-Test2$", "", stimulus_presentation),stimulus_presentation = sub("-NT$", "", stimulus_presentation))

# Step 3: Rename variable levels
filtered_data3 <- filtered_data3 %>%
  mutate(stimulus_presentation = sub("-Test1$", "", stimulus_presentation),
         stimulus_presentation = sub("-Test2$", "", stimulus_presentation))


summary_image_pres_ltm <-filtered_data3 %>%
  group_by(exp_condition, participant,stimulus_presentation) %>%
  get_summary_stats(accuracy, type = "mean_sd")

# summary_image_pres_ltm <- summary_image_pres_ltm %>%
#   mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2","Never tested" = "NeverTested"))

summary_image_pres_ltm <- summary_image_pres_ltm %>%
  mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2"))

summary_image_pres_ltm$exp_condition <- factor(summary_image_pres_ltm$exp_condition)
summary_image_pres_ltm$stimulus_presentation <- factor(summary_image_pres_ltm$stimulus_presentation)

res.aov_image_pres_ltm <- anova_test(data = summary_image_pres_ltm, dv = mean, wid = participant, within = c(stimulus_presentation,exp_condition))

get_anova_table(res.aov_image_pres_ltm)

print("These post-hoc comparisons show the difference of sample position in Test 1 and Test 2(*)")
image_effects <- summary_image_pres_ltm %>%
  group_by(exp_condition)%>%
  pairwise_t_test(
    mean ~ stimulus_presentation, paired = TRUE,
    p.adjust.method = "holm")

image_effects


```



#### Post hoc comparisons (unpruned)
The post hoc comparisons underscore the considerable difference in accuracy between information previously held in a state of inattention and information that was continuously attended to. Moreover, these comparisons highlight the testing effect in working memory, revealing significantly improved performance for materials that required retrieval and self-generation during the WM task, in contrast to mere study of the material. 

```{r Statistical analysis post-hoc comparisons RIDER 1, echo=FALSE}
print("In the following post-hoc tests I am pruning additional comparisons")

full_data_summary <-full_data %>%
  group_by(task, exp_condition, participant) %>%
  get_summary_stats(accuracy, type = "mean_sd")

pwc <- full_data_summary %>%
  group_by(task)%>%
  pairwise_t_test(
    mean ~ exp_condition, paired = TRUE,
    p.adjust.method = "holm")

print("This table shows all pairwise comparisons following the ANOVA anaylsis to get a detailed understanding of retrieval benefits")
pwc

print("These t-tests check for the additional difference in accuracies in regard to WM report (WM Bias) --> here also Test 2 vs. Baseline becomes significant")

WM_bias <-alternative_ltm2 %>%
  group_by(trial_type, participant) %>%
  get_summary_stats(accuracy_ltm, type = "mean_sd")


WM_bias %>%
  pairwise_t_test(
    mean ~ trial_type, paired = TRUE,
    p.adjust.method = "holm")

#pairwise comparisons mnemonic distance

pwc_mnem_dis <- full_data_summary_mnem_dis %>%
  group_by(task)%>%
  pairwise_t_test(
    mean ~ mnemonic_dis, paired = TRUE,
    p.adjust.method = "holm")

print("This table shows all pairwise comparisons for mnemonic distance in both tasks")
pwc_mnem_dis

```
<br>
<br>
<br>

### Pruning for mean performance
Pruning shows a benefit especially for the test2 condition(unattended storage)

<br>
<br>
<br>

```{r pruning plot RIDER 1, echo = FALSE, out.width="130%", fig.cap="<br><br>Figure 3: shows a comparison of pruned (purple) and unpruned (orange) data in LTM. We only see a substantial pruning benefit in the test 2 condition, which in pruned data shows a significantly better performance compared to the baseline condition."}
summary_stats_LTM_P <- summarySE(LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant","pruned"),na.rm = T)
summary_study_level_LTM_g <- summarySE(summary_stats_LTM_P, measurevar = "accuracy_ltm", groupvars = c("trial_type","pruned"),na.rm = T)

pointposMale <- c(-0.6,-0.79,-0.65,-0.55)
pointposFemale <- c(0.55,0.65,0.83,0.61)
showLegend <- c('PRUNED','UNPRUNED')

fig <- plot_ly(type = 'violin')

i = 0
for (i in 1:length(unique(summary_stats_LTM_P$trial_type))) {
 fig <- add_trace(
    fig,
    x = summary_stats_LTM_P$trial_type[summary_stats_LTM_P$pruned == 'YES' & summary_stats_LTM_P$trial_type == unique(summary_stats_LTM_P$trial_type)[i]],
    y = summary_stats_LTM_P$accuracy_ltm[summary_stats_LTM_P$pruned == 'YES' & summary_stats_LTM_P$trial_type == unique(summary_stats_LTM_P$trial_type)[i]],
    hoveron = "points+kde",
    legendgroup = 'pruned',
    scalegroup = 'pruned',
    name = 'pruned',
    side = 'negative',
    opacity=0.5,
    box = list(
      visible = T
    ),
    points = 'all',
    pointpos = pointposMale[i],
    jitter = 0.2,
    scalemode = 'count',
    meanline = list(
      visible = T
    ),
    color = I("#400980"),
    marker = list(
      line = list(
        width = 2,
        color = "#400980"
      ),
      symbol = 'line-ns'
    ),
    showlegend = T
    ) 

fig <- fig %>%
    add_trace(
      x = summary_stats_LTM_P$trial_type[summary_stats_LTM_P$pruned == 'NO' & summary_stats_LTM_P$trial_type == unique(summary_stats_LTM_P$trial_type)[i]],
      y = summary_stats_LTM_P$accuracy_ltm[summary_stats_LTM_P$pruned == 'NO' & summary_stats_LTM_P$trial_type == unique(summary_stats_LTM_P$trial_type)[i]],
      hoveron = "points+kde",
      legendgroup = 'unpruned',
      scalegroup = 'unpruned',
      name = 'unpruned',
      side = 'positive',
      opacity=0.5,
      box = list(
        visible = T
      ),
      points = 'all',
      pointpos = pointposFemale[i],
      jitter = 0.1,
      scalemode = 'count',
      meanline = list(
        visible = T
      ),
      color = I("#8dd3c7"),
      marker = list(
        line = list(
          width = 2,
          color = "#8dd3c7"
        ),
        symbol = 'line-ns'
      ),
      showlegend = T
  )
}

fig <- layout(
  fig,
  title = "Angular difference as accuracy<br><i>Comparison of pruned vs. unpruned data",
  yaxis = list(
    zeroline = F
  ),
  violingap = 0,
  violingroupgap = 0,
  violinmode = 'overlay',
  legend = list(
    tracegroupgap = 1
  )
)

#fig

```


```{r pruning plot RIDER 1 classic, echo = FALSE, out.width="130%", fig.cap="<br><br>Figure 4: shows the classical pruning LTM plot with WM included"}

summary_stats_participant_LTM <- summarySE(data_LTM_pruned, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_LTM <- summarySE(summary_stats_participant_LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)
summary_study_level_LTM$participant <- 1

summary_stats_participant_LTM$participant <- factor(summary_stats_participant_LTM$participant)
summary_study_level_LTM$participant <- factor(summary_study_level_LTM$participant)
summary_study_level_WB_p$participant <- factor(summary_study_level_WB_p$participant)


level_order <- c('One-item prioritized', 'Two-item prioritized', 'Two-item deprioritized','Never tested')

summary_stats_participant_LTM$trial_type[summary_stats_participant_LTM$trial_type == 'Baseline'] <- "One-item prioritized"
summary_stats_participant_LTM$trial_type[summary_stats_participant_LTM$trial_type == 'Test 1'] <- "Two-item prioritized"
summary_stats_participant_LTM$trial_type[summary_stats_participant_LTM$trial_type == 'Test 2'] <- "Two-item deprioritized"

summary_study_level_LTM$trial_type[summary_study_level_LTM$trial_type == 'Baseline'] <- "One-item prioritized"
summary_study_level_LTM$trial_type[summary_study_level_LTM$trial_type == 'Test 1'] <- "Two-item prioritized"
summary_study_level_LTM$trial_type[summary_study_level_LTM$trial_type == 'Test 2'] <- "Two-item deprioritized"

summary_study_level_WB_p$trial_type[summary_study_level_WB_p$trial_type == 'Baseline'] <- "One-item prioritized"
summary_study_level_WB_p$trial_type[summary_study_level_WB_p$trial_type == 'Test 1'] <- "Two-item prioritized"
summary_study_level_WB_p$trial_type[summary_study_level_WB_p$trial_type == 'Test 2'] <- "Two-item deprioritized"

summary_study_level_WB_p$participant <- 1

ggplot(data = summary_stats_participant_LTM, aes(x = factor(trial_type,level = level_order), y = accuracy_ltm, fill = participant)) +
  geom_line(data = summary_stats_participant_LTM,aes(group = participant, x = factor(trial_type,level = level_order), y = accuracy_ltm),color = "grey", size = 0.3, alpha = 0.5)+
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "A") +
  theme_light() +
  geom_point(data = summary_study_level_LTM, aes(x = trial_type, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_LTM, aes(x = trial_type, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_LTM, aes(x = trial_type, group = 1), colour = "black", size = 0.5) +geom_text(data = summary_study_level_LTM, aes(x = trial_type, y = accuracy_ltm, label = round(accuracy_ltm, 2)),
            color = "black", vjust = 2, size = 4,hjust = 1) +
  geom_point(data = summary_study_level_WB_p, aes(x = trial_type, y = accuracy_ltm),  colour = "forestgreen", size = 2)+
  geom_errorbar(data = summary_study_level_WB_p, aes(x = trial_type, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "forestgreen", size = 0.8)+geom_text(data = summary_study_level_WB_p, aes(x = trial_type, y = accuracy_ltm, label = round(accuracy_ltm, 2)),
            color = "forestgreen", vjust = -2, size = 4,hjust = 1) +
  ylim(c(110,10)) +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "Experimental condition"  # Add a new x-axis title at the bottom
  ) +
  ylab("Error (°)") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type), y = accuracy_ltm, fill = factor(trial_type)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#56B4E9")+geom_vline(xintercept=3.7)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 14),
    axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "grey", fill=NA, size=1))

print("as shown in the plot above, performance slightly increased when using WM report for accuracy calculations")
print("pairwise comparsins of the WM report accuracies resamble those of accurayies in regard to WM sample")

summary_stats_participant_WB_p %>%
  pairwise_t_test(
    accuracy_ltm ~ trial_type , paired = TRUE,
    p.adjust.method = "holm")

summary_stats_participant_LTM$WM_point <- "WM_sample"

pruning_and_bias <- rbind(summary_stats_participant_WB_p,summary_stats_participant_LTM)

pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$trial_type=="Never tested"),]


pruning_and_bias$trial_type[pruning_and_bias$trial_type == 'One-item prioritized'] <- "Baseline"
pruning_and_bias$trial_type[pruning_and_bias$trial_type == 'Two-item prioritized'] <- "Test 1"
pruning_and_bias$trial_type[pruning_and_bias$trial_type == 'Two-item deprioritized'] <- "Test 2"

pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="50"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="81"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="170"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="88"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="96"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="102"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="111"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="170"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="118"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="119"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="143"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="178"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="39"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="2"),]
pruning_and_bias<-pruning_and_bias[!(pruning_and_bias$participant=="66"),]


pruning_and_bias %>%
  group_by(trial_type)%>%
  pairwise_t_test(
    accuracy_ltm ~ WM_point , paired = TRUE,
    p.adjust.method = "holm")

```

### Slopes after pruning become sligtly steeper 

```{r slopes pruned data, echo = FALSE, out.width="130%", fig.cap="<br><br>Figure 4: shows the classical pruning LTM plot with WM included"}


# LTM data

data_LTM_reg<-filter(data_LTM_pruned, !(mnemonic_diss == "Baseline") )
data_LTM_reg<-filter(data_LTM_reg, !(mnemonic_diss == "Never tested") )



#recode variables for regression analysis
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 2- Test 1'] <- 0
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 1- Test 1'] <- 1
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 2- Test 2'] <- 2
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 1- Test 2'] <- 3

data_LTM_reg$mnemonic_diss <- as.numeric(data_LTM_reg$mnemonic_diss)

summary_linear_fit_ltm <- summarySE(data_LTM_reg, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)

linear_fit_LTM <- group_by(summary_linear_fit_ltm, participant) %>% summarize(b0 = coef(glm(accuracy_ltm ~ mnemonic_diss))[1],
                                b1 = coef(glm(accuracy_ltm ~ mnemonic_diss))[2])


summary_stats_participant_LTM_md <- summarySE(data_LTM_pruned, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)
summary_study_level_LTM_md <- summarySE(summary_stats_participant_LTM_md, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss"),na.rm = T)


summary_stats_participant_LTM_md<-summary_stats_participant_LTM_md[!(summary_stats_participant_LTM_md$mnemonic_diss=="Baseline"),]
summary_stats_participant_LTM_md<-summary_stats_participant_LTM_md[!(summary_stats_participant_LTM_md$mnemonic_diss=="Never tested"),]
summary_study_level_md<-summary_study_level_md[!(summary_study_level_md$mnemonic_dis=="Baseline"),]

rain_height <- .1

t_test_slopes_LTM <- t.test(linear_fit_LTM$b1, mu = 0)

print("pruned data LTM slopes against 0")
t_test_slopes_LTM





  
```

<br>
<br>
<br>

## Statistics for pruned data
#### In the following, I am running equivalent tests for the pruned data, to give an overview which effects change.
#### We show a 2 x 2 ANOVA and post-hoc testing after pruning

<br>
<br>
<br>
  
```{r Statistical analysis anova RIDER1 pruned data, echo=FALSE}
# I have created the dfs that I use for the stats directly above, where i create all
# the other dfs for unpruned stats

#naming for pruned data
colnames(data_subset_p)[1] = "accuracy"
colnames(data_subset_p)[2] = "exp_condition"
colnames(data_subset_mnemonic_dis_p)[1] = "accuracy"
colnames(data_subset_mnemonic_dis_p)[2] = "mnemonic_dis"
colnames(data_subset_new_p)[2] = "exp_condition"
colnames(data_subset_new_p)[1] = "accuracy"
colnames(data_subset_new_p)[3] = "stimulus_presentation"

print("Pruned data: 2 (1/2 sample) x 2 (1/2 test) ANOVA focuses on the stimulus effects in the pruned LTM data")

# Step 1: Rename variable levels
filtered_data_p <- data_subset_new_p %>%
  mutate(stimulus_presentation = sub("-Test1$", "", stimulus_presentation),
         stimulus_presentation = sub("-Test2$", "", stimulus_presentation),stimulus_presentation = sub("-NT$", "", stimulus_presentation))

# create summary df
summary_image_pres_ltm_p <-filtered_data_p %>%
  group_by(exp_condition, participant,stimulus_presentation) %>%
  get_summary_stats(accuracy, type = "mean_sd")

#delete conditions you don't want to include in your model
summary_image_pres_ltm_p<-summary_image_pres_ltm_p[!(summary_image_pres_ltm_p$exp_condition=="Baseline"),]



summary_image_pres_ltm_p <- summary_image_pres_ltm_p %>%
  mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2","Never tested" = "NeverTested"))

# only run if you don't want to inluclude never tested
summary_image_pres_ltm_p<-summary_image_pres_ltm_p[!(summary_image_pres_ltm_p$exp_condition=="NeverTested"),]

summary_image_pres_ltm <- summary_image_pres_ltm %>%
  mutate(exp_condition = recode(exp_condition,"Test 1" = "Test1","Test 2" = "Test2"))

summary_image_pres_ltm_p$exp_condition <- factor(summary_image_pres_ltm_p$exp_condition)
summary_image_pres_ltm_p$stimulus_presentation <- factor(summary_image_pres_ltm_p$stimulus_presentation)

res.aov_image_pres_ltm_p <- anova_test(data = summary_image_pres_ltm_p, dv = mean, wid = participant, within = c(stimulus_presentation,exp_condition))

get_anova_table(res.aov_image_pres_ltm_p)

# ggplot(summary_image_pres_ltm_p, aes(x = stimulus_presentation, y = mean)) +
#   geom_bar(stat = "identity") +
#   labs(title = "stimulus_presentation",
#        x = "stimulus_presentation",
#        y = "accuracy") +
#   theme_minimal() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
#   facet_wrap(~exp_condition, ncol = 1)

summary_image_pres_ltm_p<-summary_image_pres_ltm_p[!(summary_image_pres_ltm_p$participant=="170"),]

image_effects_p <- summary_image_pres_ltm_p %>%
  group_by(exp_condition)%>%
  pairwise_t_test(
    mean ~ stimulus_presentation, paired = TRUE,
    p.adjust.method = "holm")
print("These post-hoc tests adress the difference of sample 1 / 2 in Test 1 vs. Test 2(*)")
image_effects_p


summary_exp_c_ltm_p <-filtered_data_p %>%
  group_by(exp_condition, participant) %>%
  get_summary_stats(accuracy, type = "mean_sd")
# remove participants that through pruning lost complete dataset for single conditions
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="50"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="81"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="170"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="88"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="96"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="102"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="111"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="170"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="118"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="119"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="143"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="178"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="39"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="2"),]
summary_exp_c_ltm_p<-summary_exp_c_ltm_p[!(summary_exp_c_ltm_p$participant=="66"),]



# comparisons between exp. conditions

print("These post-hoc tests address the difference in pairwise comparisons -> Baseline-Test1(ns), Baseline-Test2(*)")
condition_effects_p <- summary_exp_c_ltm_p %>%
  pairwise_t_test(
    mean ~ exp_condition, paired = TRUE,
    p.adjust.method = "holm")
condition_effects_p



```


```{r PRUNED post-hoc comparisons RIDER 1, echo=FALSE}
# Filter the data for the specific comparisons
# data_test2_vs_baseline <- data_LTM_pruned %>%
#   filter(trial_type %in% c("Test 2", "Baseline"))
# 
# data_test2_vs_test1 <- data_LTM_pruned %>%
#   filter(trial_type %in% c("Test 2", "Test 1"))
# 
# data_test2_vs_baseline_s <-data_test2_vs_baseline %>%
#   group_by(trial_type, participant) %>%
#   get_summary_stats(accuracy_ltm, type = "mean_sd")
# 
# data_test2_vs_baseline_sum <-data_test2_vs_test1 %>%
#   group_by(trial_type, participant) %>%
#   get_summary_stats(accuracy_ltm, type = "mean_sd")
# 
# # Perform paired t-test for test2 vs. baseline
# 
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==2),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==70),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==12),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==39),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==50),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==12),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==88),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==81),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==96),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==111),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==143),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==178),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==118),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==119),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==66),]
# data_test2_vs_baseline_s<-data_test2_vs_baseline_s[!(data_test2_vs_baseline_s$participant==102),]
# 
# print("Here a paired t-test shows the significant difference in pruned data between baseline and test 2")
# 
# baseline_test2 <- data_test2_vs_baseline_s %>%
#   pairwise_t_test(
#     mean ~ trial_type, paired = TRUE,
#     p.adjust.method = "holm")
# 
# baseline_test2
#print("we see that in the pruned data also the comparison between baseline and test2 becomes sig. different")
# pwc <- data_test2_vs_baseline_sum %>%
#   pairwise_t_test(
#     mean ~ trial_type, paired = TRUE,
#     p.adjust.method = "holm")
# 
# print("Here a paired t-test shows the significant difference in pruned data between test 1 and test 2")
# pwc

```
<br>
<br>
<br>

### Mnemonic distance

Here plotted are the (linear) slopes over mnemonic distance for participant and task (WM vs. LTM) in one combined violin plot. This can be seen as an extension to the opposite trends we already see in the broader trial types.

<br>
<br>
<br>
<br>
<br>
<br>

```{r Mnemonic distance RIDER 1, echo=FALSE, out.width="130%", fig.cap="<br><br>**Figure** **4**: shows significantly different linear slopes of LTM vs. WM"}

library(PupillometryR)

# WM data 

data_WM_long_reg<-filter(data_WM_long, !(mnemonic_dis == "Baseline") )

#recode variables for regression analysis
data_WM_long_reg$mnemonic_dis[data_WM_long_reg$mnemonic_dis == 'Image 2-Test 1'] <- 0
data_WM_long_reg$mnemonic_dis[data_WM_long_reg$mnemonic_dis == 'Image 1-Test 1'] <- 1
data_WM_long_reg$mnemonic_dis[data_WM_long_reg$mnemonic_dis == 'Image 2-Test 2'] <- 2
data_WM_long_reg$mnemonic_dis[data_WM_long_reg$mnemonic_dis == 'Image 1-Test 2'] <- 3

data_WM_long_reg$mnemonic_dis <- as.numeric(data_WM_long_reg$mnemonic_dis)



summary_linear_fit <- summarySE(data_WM_long_reg, measurevar = "accuracy", groupvars = c("mnemonic_dis","participant"),na.rm = T)

linear_fit <- group_by(summary_linear_fit, participant) %>% summarize(b0 = coef(glm(accuracy ~ mnemonic_dis))[1],
                                b1 = coef(glm(accuracy ~ mnemonic_dis))[2])

t_test <- t.test(linear_fit$b1, mu = 0)

# LTM data

data_LTM_reg<-filter(data_LTM, !(mnemonic_diss == "Baseline") )
data_LTM_reg<-data_LTM_reg[!(data_LTM_reg$mnemonic_diss=="Never tested"),]


#recode variables for regression analysis
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 2- Test 1'] <- 0
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 1- Test 1'] <- 1
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 2- Test 2'] <- 2
data_LTM_reg$mnemonic_diss[data_LTM_reg$mnemonic_diss == 'Image 1- Test 2'] <- 3

data_LTM_reg$mnemonic_diss <- as.numeric(data_LTM_reg$mnemonic_diss)

summary_linear_fit_ltm <- summarySE(data_LTM_reg, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)

linear_fit_LTM <- group_by(summary_linear_fit_ltm, participant) %>% summarize(b0 = coef(glm(accuracy_ltm ~ mnemonic_diss))[1],
                                b1 = coef(glm(accuracy_ltm ~ mnemonic_diss))[2])

linear_fit_LTM$test <- "LTM"
linear_fit$test <- "WM"

linear_fit <- rbind(linear_fit, linear_fit_LTM)


summary_stats_participant_md <- summarySE(data_WM_long, measurevar = "accuracy", groupvars = c("mnemonic_dis","participant"),na.rm = T)
summary_study_level_md <- summarySE(summary_stats_participant_md, measurevar = "accuracy", groupvars = c("mnemonic_dis"),na.rm = T)

summary_stats_participant_LTM_md <- summarySE(data_LTM, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)
summary_study_level_LTM_md <- summarySE(summary_stats_participant_LTM_md, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss"),na.rm = T)


summary_stats_participant_LTM_md<-summary_stats_participant_LTM_md[!(summary_stats_participant_LTM_md$mnemonic_diss=="Baseline"),]
summary_stats_participant_LTM_md<-summary_stats_participant_LTM_md[!(summary_stats_participant_LTM_md$mnemonic_diss=="Never tested"),]
summary_study_level_md<-summary_study_level_md[!(summary_study_level_md$mnemonic_dis=="Baseline"),]

rain_height <- .1

t_test_slopes_LTM <- t.test(linear_fit_LTM$b1, mu = 0)

# we can then directly test the slopes against eachother

linear_fit<-linear_fit[!(linear_fit$participant=='20'),]

t_test_task_slopes<- linear_fit %>%
  pairwise_t_test(
    b1 ~ test, paired = TRUE)


# extract p-value and test statistic
t_test_result <- t_test_task_slopes %>%
  select(p.adj, statistic)

#bind the p-value and test statistic to your dataframe
linear_fit_pval <- bind_cols(linear_fit, t_test_result)

ggplot(linear_fit, aes(x = "", y = b1, fill = test)) +
  # clouds
    geom_flat_violin(trim=FALSE, alpha = 0.4,
    position = position_nudge(x = rain_height+.05)) +
  # rain
  geom_point(aes(colour = test), size = 2, alpha = .5, show.legend = FALSE, 
              position = position_jitter(width = rain_height, height = 0)) +
  # boxplots
  geom_boxplot(width = rain_height, alpha = 0.4, show.legend = FALSE, 
               outlier.shape = NA,
               position = position_nudge(x = -rain_height*2)) +
  # mean and SE point in the cloud
  stat_summary(fun.data = mean_cl_normal, mapping = aes(color = test), show.legend = FALSE,
               position = position_nudge(x = rain_height * 3)) +
  # adjust layout
  scale_x_discrete(name = "", expand = c(rain_height*3, 0, 0, 0.7)) +
  scale_y_continuous(name = "Slopes",
                     breaks = seq(-22,22,5), 
                     limits = c(-22,22)) +
  # custom colours and theme
  scale_fill_brewer(palette = "Dark2", name ="Task") +
  scale_colour_brewer(palette = "Dark2") +
  labs(title = 'Difference in individual slopes for performance\nacross mnemonic distances in WM and LTM')+
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        legend.position = c(0.8, 0.8),
        legend.background = element_rect(fill = "white", color = "white"))


print("In the following you see the individual t-tests against 0 and also against eachother (WM vs. LTM slopes)")
print("WM slopes against 0")
t_test
print("LTM slopes against 0")
t_test_slopes_LTM
print("WM vs. LTM slopes")
t_test_task_slopes

```

<br>
<br>
<br>

### Absolut and signed error correlation; pearson/circular corr.

<br>
<br>
<br>

```{r error correlations RIDER 1, include=FALSE, out.width="80%", fig.cap="<br><br>**Figure** **4**: shows absolut and signed error correlations between LTM and WM"}

df_pivoted <- data_WM %>% pivot_longer(cols = c('accuracy_t1_rad','accuracy_t2_rad'), 
                                   names_to = "time", 
                                   values_to = "WMreport")

df_pivoted <- df_pivoted  %>% 
 mutate(trial_type_new = case_when(
    baselinePresent  == 1 ~ "Baseline",
    trial_type !="baseline" & time == "accuracy_t1_rad"  ~ "Test 1",
    trial_type !="baseline" & time == "accuracy_t2_rad" ~ "Test 2"))


df_pivoted <- df_pivoted  %>% 
   mutate(mnemonic_dis = case_when(
     baselinePresent  == 1 ~ "Baseline",
     image2 == test1 & time == "accuracy_t1_rad" ~ "Image 2-Test 1",
     image2 == test2 & time == "accuracy_t2_rad" ~ "Image 2-Test 2",
     image1 == test1 & time == "accuracy_t1_rad" ~ "Image 1-Test 1",
     image1 == test2 & time == "accuracy_t2_rad" ~ "Image 1-Test 2"))

df_pivoted$Stimulus <- ifelse(df_pivoted$time == "accuracy_t1_rad", df_pivoted$test1, df_pivoted$test2)
df_pivoted <- select(df_pivoted, Stimulus, WMreport,trial_type_new,participant,time,mnemonic_dis)
df_pivoted <- na.omit(df_pivoted)

df_summary <- df_pivoted %>%
  group_by(trial_type_new, participant) %>%
  summarize(accuracy = mean(WMreport,na.rm = TRUE))

data_LTM <- read.csv("/Users/born/Documents/Upside_down_task/client/public/raw_data/LTM_data.csv",na.strings=c("","NA"))

data_LTM$accuracy_ltm_rad <- (apply(data_LTM[,c("this_ori_ltm", "fixedOri_ltm")], 1, function(x) angdiff(x[1], x[2])$delta_rad))

colnames(data_LTM)[colnames(data_LTM) == "ltm_image"] <- "Stimulus"

df_pivoted <- left_join(df_pivoted, data_LTM, by = c("Stimulus", "participant"))

df_pivoted <- select(df_pivoted, participant, trial_type_new, Stimulus, WMreport, accuracy_ltm_rad,time,mnemonic_dis)

colnames(df_pivoted)[colnames(df_pivoted) == "accuracy_ltm_rad"] <- "LTMreport"

trial_types <- unique(df_pivoted$trial_type_new)


df_trial_type <- df_pivoted %>%
    filter(trial_type_new == "Baseline") %>%
    select(Stimulus, WMreport, LTMreport,participant)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(20, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:20) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_baseline <- array_3d

df_trial_type <- df_pivoted %>%
    filter(trial_type_new == "Test 2") %>%
    select(Stimulus, WMreport, LTMreport,participant,time)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(20, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:20) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_test2 <- array_3d


df_trial_type <- df_pivoted %>%
    filter(trial_type_new == "Test 1") %>%
    select(Stimulus, WMreport, LTMreport,participant)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(40, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:40) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_test1 <- array_3d

# doing the same for mnemonic distances

df_trial_type <- df_pivoted %>%
    filter(mnemonic_dis == "Image 2-Test 1") %>%
    select(Stimulus, WMreport, LTMreport,participant)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(20, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:20) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_Image_2_Test_1 <- array_3d

df_trial_type <- df_pivoted %>%
    filter(mnemonic_dis == "Image 1-Test 1") %>%
    select(Stimulus, WMreport, LTMreport,participant)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(20, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:20) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_Image_1_Test_1 <- array_3d

df_trial_type <- df_pivoted %>%
    filter(mnemonic_dis == "Image 2-Test 2") %>%
    select(Stimulus, WMreport, LTMreport,participant)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(20, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:20) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_Image_2_Test_2 <- array_3d


df_trial_type <- df_pivoted %>%
    filter(mnemonic_dis == "Image 1-Test 2") %>%
    select(Stimulus, WMreport, LTMreport,participant)

n_participants <- length(unique(df_trial_type$participant))
array_3d <- array(NA, dim = c(20, 3, n_participants))
for (i in 1:n_participants) {
  participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
  for (j in 1:20) {
    stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
    if (nrow(stimulus_row) > 0) {
      array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
    }
  }
  print(array_3d[ , , i])
}

array_Image_1_Test_2 <- array_3d


```

```{r Correlation between Memory errors RIDER1, echo=FALSE,include = FALSE, message=FALSE}
# I translated both these functions from the matlab library circular stats, to compare with the results of the "circular" R library.
circ_mean <- function(alpha, w = NULL) {
    if (is.null(w)) {
        w <- rep(1, length(alpha))
    }
    r <- sum(w * exp(1i * alpha))
    mu <- Arg(r)
    return(mu)
}


circ_corrcc <-function(alpha1, alpha2) {
    n <- length(alpha1)
    alpha1_bar <- circ_mean(alpha1)
    alpha2_bar <- circ_mean(alpha2)
    
    num <- sum(sin(alpha1 - alpha1_bar) * sin(alpha2 - alpha2_bar))
    den <- sqrt(sum(sin(alpha1 - alpha1_bar)^2) * sum(sin(alpha2 - alpha2_bar)^2))
    rho <- num / den
    
    l20 <- mean(sin(alpha1 - alpha1_bar)^2)
    l02 <- mean(sin(alpha2 - alpha2_bar)^2)
    l22 <- mean((sin(alpha1 - alpha1_bar)^2) * (sin(alpha2 - alpha2_bar)^2))
    
    ts <- sqrt((n * l20 * l02) / l22) * rho
    pval <- 2 * (1 - pnorm(abs(ts)))
    
    return(c(rho, pval))
}


results_baseline <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_baseline)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_baseline[,2,i])
  col3 = as.numeric(array_baseline[,3,i])
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_baseline[i, "circular_corr"] <- corr[1]
  results_baseline[i,"abserror_corr"] <- cor(abs(col2), abs(col3), method = "pearson")
  results_baseline$trial_type <- "Baseline"
  results_baseline[i,"Participant"] <- i
}


results_test1 <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_test1)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_test1[,2,i])
  col3 = as.numeric(array_test1[,3,i])
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_test1[i, "circular_corr"] <- corr[1]
  results_test1[i,"abserror_corr"] <- abs_error
  results_test1[i,"Participant"] <- i
  results_test1$trial_type <- "Test 1"
}


results_test2 <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_test2)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_test2[,2,i])
  col3 = as.numeric(array_test2[,3,i])
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_test2[i,] = c(i, corr, abs_error)
  results_test2$trial_type <- "Test 2"
  results_test2[i,"Participant"] <- i
}

error_correlations_absolut <-rbind(results_baseline,results_test1,results_test2)


# error correlations for mnemonic distance

results_Image2_Test1 <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_Image_2_Test_1)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_Image_2_Test_1[,2,i])
  col3 = as.numeric(array_Image_2_Test_1[,3,i])
  
  # Remove missing values
  complete_data <- na.omit(data.frame(col2, col3))
  col2 <- complete_data[,1]
  col3 <- complete_data[,2]
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_Image2_Test1[i,] = c(i, corr, abs_error)
  results_Image2_Test1$trial_type <- "Image2_Test1"
  results_Image2_Test1[i,"Participant"] <- i
}

results_Image1_Test1 <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_Image_1_Test_1)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_Image_1_Test_1[,2,i])
  col3 = as.numeric(array_Image_1_Test_1[,3,i])
  
  # Remove missing values
  complete_data <- na.omit(data.frame(col2, col3))
  col2 <- complete_data[,1]
  col3 <- complete_data[,2]
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_Image1_Test1[i,] = c(i, corr, abs_error)
  results_Image1_Test1$trial_type <- "Image1_Test1"
  results_Image1_Test1[i,"Participant"] <- i
}


results_Image2_Test2 <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_Image_2_Test_2)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_Image_2_Test_2[,2,i])
  col3 = as.numeric(array_Image_2_Test_2[,3,i])
  
  # Remove missing values
  complete_data <- na.omit(data.frame(col2, col3))
  col2 <- complete_data[,1]
  col3 <- complete_data[,2]
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_Image2_Test2[i,] = c(i, corr, abs_error)
  results_Image2_Test2$trial_type <- "Image2_Test2"
  results_Image2_Test2[i,"Participant"] <- i
}

results_Image1_Test2 <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())

for (i in 1:dim(array_Image_1_Test_2)[3]) {
  # Get the second and third columns for this participant
  col2 = as.numeric(array_Image_1_Test_2[,2,i])
  col3 = as.numeric(array_Image_1_Test_2[,3,i])
  
  # Remove missing values
  complete_data <- na.omit(data.frame(col2, col3))
  col2 <- complete_data[,1]
  col3 <- complete_data[,2]
  
  # Pass the numeric values to circ_corrcc
  corr = circ_corrcc(col2, col3)
  abs_error = cor(abs(col2), abs(col3),method = "pearson")
  print(abs_error)
  
  # Store the results in the data frame
  results_Image1_Test2[i,] = c(i, corr, abs_error)
  results_Image1_Test2$trial_type <- "Image1_Test2"
  results_Image1_Test2[i,"Participant"] <- i
}


error_correlations_absolut_md <-rbind(results_Image2_Test1,results_Image1_Test1,results_Image2_Test2,results_Image1_Test2)

```


```{r Plots between Memory errors RIDER1 trial types, echo=FALSE,out.width="130%", message=FALSE}

level_order_md <- c('Image2_Test1', 'Image1_Test1','Image2_Test2','Image1_Test2')

subset_baseline <- error_correlations_absolut[error_correlations_absolut$trial_type == "Baseline", ]
subset_test1 <- error_correlations_absolut[error_correlations_absolut$trial_type == "Test 1", ]
subset_test2<- error_correlations_absolut[error_correlations_absolut$trial_type == "Test 2", ]



fig1 <- plot_ly(type = 'box')
fig1 <- fig1 %>% add_boxplot(y = subset_baseline$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              marker = list(color = 'rgb(107,174,214)'),
              line = list(color = 'rgb(107,174,214)'),
              name = "Baseline")
fig1 <- fig1 %>% add_boxplot(y = subset_test1$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              marker = list(color = 'rgb(107,174,214)'),
              line = list(color = 'rgb(107,174,214)'),
              name = "Test1")

fig1 <- fig1 %>% add_boxplot(y = subset_test2$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              marker = list(color = 'rgb(107,174,214)'),
              line = list(color = 'rgb(107,174,214)'),
              name = "Test2")%>%
  layout(xaxis = list(title = '', showgrid = FALSE), yaxis = list(title = 'Pearson correlation of absolut errors', showgrid = FALSE))

#fig1 <- fig1 %>% layout(title = "Pearson correlation of absolut errors by exp. conditions in WW/LTM task")

#fig1

fig2 <- plot_ly(type = 'box')
fig2 <- fig2 %>% add_boxplot(y = subset_baseline$circular_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              marker = list(color = 'rgb(107,174,214)'),
              line = list(color = 'rgb(107,174,214)'),
              name = "Baseline")
fig2 <- fig2 %>% add_boxplot(y = subset_test1$circular_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              marker = list(color = 'rgb(107,174,214)'),
              line = list(color = 'rgb(107,174,214)'),
              name = "Test1")
fig2 <- fig2 %>% add_boxplot(y = subset_test2$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              marker = list(color = 'rgb(107,174,214)'),
              line = list(color = 'rgb(107,174,214)'),
              name = "Test2")%>%
  layout(xaxis = list(title = '', showgrid = FALSE), yaxis = list(title = 'Circ. correlation', showgrid = FALSE))

#fig2 <- fig2 %>% layout(title = "Circ. correlation of signed errors in WW/LTM task")

#fig2


s1 <- subplot(fig1, fig2)%>%  
  layout(annotations = list( 
    list(x = 0.15 , y = 0.95, text = "(absolut error) pearson corr.", showarrow = T, xref='paper', yref='paper'), 
    list(x = 0.85 , y = 0.95, text = "(signed error) circ. corr.", showarrow = T, xref='paper', yref='paper')) 
  )
s1
```
<br>
<br>
<br>
```{r Plots between Memory errors RIDER1 mnemonoc distances, out.width="130%", echo=FALSE, message=FALSE}

# subset_Image2_Test1 <- error_correlations_absolut_md[error_correlations_absolut_md$trial_type == "Image2_Test1", ]
# subset_Image1_Test1 <- error_correlations_absolut_md[error_correlations_absolut_md$trial_type == "Image1_Test1", ]
# subset_Image1_Test2<- error_correlations_absolut_md[error_correlations_absolut_md$trial_type == "Image1_Test2", ]
# subset_Image2_Test2<- error_correlations_absolut_md[error_correlations_absolut_md$trial_type == "Image2_Test2", ]
# 
# 
# # same for mnemonic distance
# 
# fig1 <- plot_ly(type = 'box')
# fig1 <- fig1 %>% add_boxplot(y = subset_Image2_Test1$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image2_Test1")
# fig1 <- fig1 %>% add_boxplot(y = subset_Image1_Test1$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image1_Test1")
# 
# fig1 <- fig1 %>% add_boxplot(y = subset_Image2_Test2$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image2_Test2")
# fig1 <- fig1 %>% add_boxplot(y = subset_Image1_Test2$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image1_Test2")
# 
# #fig1 <- fig1 %>% layout(title = "Pearson correlation of absolut errors by exp. conditions in WW/LTM task")
# 
# #fig1
# 
# fig2 <- plot_ly(type = 'box')
# fig2 <- fig2 %>% add_boxplot(y = subset_Image2_Test1$circular_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image2_Test1")
# fig2 <- fig2 %>% add_boxplot(y = subset_Image1_Test1$circular_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image1_Test1")
# fig2 <- fig2 %>% add_boxplot(y = subset_Image2_Test2$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image2_Test2")
# fig2 <- fig2 %>% add_boxplot(y = subset_Image1_Test2$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
#               marker = list(color = "#bebada"),
#               line = list(color = "#bebada"),
#               name = "Image1_Test2")
# 
# #fig2 <- fig2 %>% layout(title = "Circ. correlation of signed errors in WW/LTM task")
# 
# #fig2
# 
# 
# s1 <- subplot(fig1, fig2)%>%  
#   layout(annotations = list( 
#     list(x = 0.15 , y = 0.95, text = "(absolut error) pearson corr.", showarrow = T, xref='paper', yref='paper'), 
#     list(x = 0.85 , y = 0.95, text = "(signed error) circ. corr.", showarrow = T, xref='paper', yref='paper')) 
#   )
# s1


```
<br>
<br>
<br>

<br>
<br>
<br>
```{r calculating accurcy RIDER2, include=FALSE}

# Group the data by participant and remove the first 6 trials for each participant
data_WM_V2 <- data_WM_V2 %>%
  group_by(participant) %>%
  slice(7:n()) %>%
  ungroup()

# Identify the row indices that have been deleted
practice_trials <- data_WM_V2 %>%
  group_by(participant) %>%
  slice(1:6)

#length(unique(data_WM_V2$participant))

#calculating the correct fixed orientations for the 2-item trials:
#depending on whether the stimulus was presented in image 1 or image 2
data_WM_V2$startOri1 <- as.character(data_WM_V2$startOri1)

data_WM_V2 <- data_WM_V2 %>%
  rowwise() %>%
  mutate(fixedOri_t1 = ifelse((test1 == image1), startOri1,ifelse((test1 ==  image2),startOri2,NA)))

data_WM_V2 <- data_WM_V2 %>%
  rowwise() %>%
  mutate(fixedOri_t2 = ifelse((test2 == image1), startOri1,ifelse((test2 ==  image2),startOri2,NA)))


# calculate remainder of this_ori variable to adjust for cases that are beyond 360 degrees
data_WM_V2 <- data_WM_V2 %>% mutate(accuracy_t1 = log_response_t1.corr)#Modulus (Remainder from division)
data_WM_V2 <- data_WM_V2 %>% mutate(accuracy_t2 = log_response_t2.corr)#Modulus (Remainder from division)
# 
# # calculating accuracy for test 1 and test 2
data_WM_V2$accuracy_t1 <- as.numeric(data_WM_V2$accuracy_t1)

data_WM_V2$accuracy_t2 <- as.numeric(data_WM_V2$accuracy_t2)

# I remove the rows in which either for test 1 or test 2 the participant did not answer in time

data_WM_V2<-data_WM_V2[!(data_WM_V2$imgChoice1=='stim/respond_faster.png'),]

data_WM_V2 <- data_WM_V2 %>%
  filter(is.na(imgChoice2) | imgChoice2 != "stim/respond_faster.png")


# count_above_15 <- data_WM_V2 %>%
#   filter(imgChoice2 == "stim/respond_faster.png" | imgChoice1 == "stim/respond_faster.png") %>%
#   nrow()
# 
# total_participants <- 65
# trials_per_participant <- 60
# 
# # Calculate the average number of trials per participant
# average_trials_per_participant <- count_above_15 / total_participants
# 
# # Calculate the percentages
# average_percentage <- (average_trials_per_participant / trials_per_participant) * 100
# 
# # Calculate the minimum and maximum percentages
# min_percentage <- (0 / trials_per_participant) * 100
# max_percentage <- (4.76 / trials_per_participant) * 100
# 
# # Format the result
# result <- sprintf("%.2f%% of trials on average; min = %.2f%%, max = %.2f%%",
#                   average_percentage, min_percentage, max_percentage)
# 
# cat(result)





# pivot longer
data_WM_long_V2<- data_WM_V2 %>% pivot_longer(cols=c('accuracy_t1','accuracy_t2'),names_to='attention_condition',values_to='accuracy')

# extracting numeric reaction times
data_WM_V2$adjust_keys_t1_numeric <- apply(data_WM_V2, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["log_response_t1.rt"])))


data_WM_V2$adjust_keys_t2_numeric <- apply(data_WM_V2, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["log_response_t2.rt"])))

# create separate df for reaction times
data_WM_rt_V2<- data_WM_V2 %>% pivot_longer(cols=c('adjust_keys_t1_numeric','adjust_keys_t2_numeric'),names_to='rt_test',values_to='rt')


data_LTM_V2 <- rbind.fill(data_LTM_V2,data_WM_V2[c("test1", "test2","participant","image1","image2")])

# defining the menemonic distance conditions

data_LTM_V2 <- data_LTM_V2  %>%
    group_by(participant)%>%
    mutate(mnemonic_diss = case_when(ltm_image %in% test1 & ltm_trial == 'baseline' ~ "Baseline",
                                     ltm_image %in%  test1 & ltm_image %in%  image2  ~ "Image 2- Test 1",
                                     ltm_image %in%  test1 & ltm_image %in%  image1  ~ "Image 1- Test 1",
                                     ltm_image %in%  test2 & ltm_image %in%  image2 ~ "Image 2- Test 2",
                                     ltm_image %in%  test2 & ltm_image %in% image1 ~ "Image 1- Test 2",
                                     ltm_image %notin% test1 & ltm_image %notin% test2 ~ "Never tested"))

# defining the simple trial types (as broader experimental conditions)
data_LTM_V2 <- data_LTM_V2 %>%
  group_by(participant)%>%
  mutate(trial_type = case_when(ltm_trial == 'baseline' ~ "Baseline",
                                 ltm_image %in%  test1  ~   "Test 1",
                                 ltm_image %in%  test2  ~   "Test 2",
                                 ltm_image %notin% test1 & ltm_image %notin% test2 ~ "Never tested"))

# data_LTM_V2 <- data_LTM_V2 %>%
#   group_by(participant)%>%
#   mutate(image_presentation = case_when(ltm_image %in% test1 & ltm_trial == 'baseline' ~ "Baseline",
#                                  ltm_image %in%  image1  ~   "Image 1",
#                                  ltm_image %in%  image2  ~   "Image 2"))


data_LTM_V2 <- data_LTM_V2 %>%
  group_by(participant)%>%
  mutate(image_presentation = case_when(ltm_trial == 'baseline' ~ "Baseline",
                                 ltm_image %in%  test1 & ltm_image %in% image1  ~   "Img1-Test1",
                                 ltm_image %in%  test1 & ltm_image %in% image2  ~   "Img2-Test1",
                                 ltm_image %in%  test2 & ltm_image %in% image1  ~   "Img1-Test2",
                                 ltm_image %in%  test2 & ltm_image %in% image2  ~   "Img2-Test2",
                                 ltm_image %notin% test1 & ltm_image %notin% test2 & ltm_image %in% image1 ~ "Img1-NT",
                                 ltm_image %notin% test1 & ltm_image %notin% test2 & ltm_image %in% image2 ~ "Img2-NT"))



# calculate ltm accuracy
data_LTM_V2 <- data_LTM_V2 %>% mutate(ori_ltm = this_ori_ltm %% 360)#Modulus (Remainder from division)


# calculating accuracy for LTM test

data_LTM_V2 <- data_LTM_V2 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm -fixedOri_ltm))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm -fixedOri_ltm))

data_LTM_V2 <- transform(data_LTM_V2, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

data_LTM_V2 <- data_LTM_V2 %>% 
  rowwise() %>%
  mutate(angle_ltm = this_ori_ltm -fixedOri_ltm)

#remove extra WM rows again
data_LTM_V2 <- data_LTM_V2[rowSums(is.na(data_LTM_V2)) == 0|rowSums(is.na(data_LTM_V2)) == 1| rowSums(is.na(data_LTM_V2)) == 2|rowSums(is.na(data_LTM_V2)) == 3|rowSums(is.na(data_LTM_V2)) == 4,]


# remove participants also from LTM data (same participants as removed for WM)
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==39),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==28),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==69),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==62),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==12),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==75),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==71),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==44),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==68),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==29),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==81),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==56),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==77),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==79),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==17),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==46),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==86),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==36),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==60),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==73),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==52),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==78),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==89),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==47),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==43),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==34),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==74),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==97),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==93),]
data_LTM_V2<-data_LTM_V2[!(data_LTM_V2$participant==98),]

# simple retrieval trial types


data_WM_long_V2 <- data_WM_long_V2  %>% 
  mutate(trial_type_new = case_when(
    baselinePresent  == 1 ~ "Baseline",
    trial_type !="baseline" & attention_condition == "accuracy_t1"  ~ "Test 1",
    trial_type !="baseline" & attention_condition == "accuracy_t2" ~ "Test 2"))

# image presentation

data_WM_long_V2 <- data_WM_long_V2  %>% 
  mutate(image_presentation = case_when(
    baselinePresent  == 1 ~ "Baseline",
    image1 == test1 & attention_condition == "accuracy_t1"  ~ "Img1-Test1",
    image1 == test2 & attention_condition == "accuracy_t2" ~ "Img1-Test2",
    image2 == test2 & attention_condition == "accuracy_t2" ~ "Img2-Test2",
    image2 == test1 & attention_condition == "accuracy_t1" ~ "Img2-Test1"))

# just check for different trial types (in rt dataframe)

data_WM_rt_V2 <- data_WM_rt_V2  %>% 
  mutate(trial_type_new = case_when(
    baselinePresent  == 1 ~ "Baseline",
    trial_type !="baseline" & rt_test == "adjust_keys_t1_numeric"  ~ "Test 1",
    trial_type !="baseline" & rt_test == "adjust_keys_t2_numeric" ~ "Test 2"))

# Check for mnemonic distance

data_WM_long_V2 <- data_WM_long_V2  %>% 
  mutate(mnemonic_dis = case_when(
    baselinePresent  == 1 ~ "Baseline",
    image2 == test1 & attention_condition == "accuracy_t1"      ~ "Image 2-Test 1",
    image2 == test2 & attention_condition == "accuracy_t2" ~ "Image 2-Test 2",
    image1 == test1 & attention_condition == "accuracy_t1" ~ "Image 1-Test 1",
    image1 == test2 & attention_condition == "accuracy_t2" ~ "Image 1-Test 2"))

# Check for mnemonic distance in reaction times
data_WM_rt_V2 <- data_WM_rt_V2  %>% 
  mutate(mnemonic_dis = case_when(
    baselinePresent  == 1 ~ "Baseline",
    image2 == test1 & rt_test == "adjust_keys_t1_numeric"      ~ "Image 2-Test 1",
    image2 == test2 & rt_test == "adjust_keys_t2_numeric" ~ "Image 2-Test 2",
    image1 == test1 & rt_test == "adjust_keys_t1_numeric" ~ "Image 1-Test 1",
    image1 == test2 & rt_test == "adjust_keys_t2_numeric" ~ "Image 1-Test 2"))



#drop rows that are NA
data_WM_rt_V2 <-data_WM_rt_V2 %>% drop_na(rt)
data_WM_long_V2 <-data_WM_long_V2 %>% drop_na(accuracy)


# select participants that need to be excluded due to average performance < 0.6
data_WM_mean_acc <- data_WM_long_V2 %>%
  group_by(participant) %>%
  summarize(mean_acc = mean(accuracy))



# remove participant with too low performance average
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==39),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==28),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==69),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==62),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==12),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==75),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==71),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==44),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==68),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==29),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==81),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==56),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==77),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==79),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==17),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==46),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==86),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==36),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==60),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==73),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==52),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==78),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==89),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==47),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==43),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==34),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==74),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==97),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==93),]
data_WM_long_V2<-data_WM_long_V2[!(data_WM_long_V2$participant==98),]

```

<h3 style="text-align: center; color: orange;">**RIDER 2**</h3>

## Visualisation RIDER2

<br>
<br>
<br>

### WM accuracy
<br>
<br>
<br>
```{r RIDER2 WM accuracy, echo = FALSE,out.width="130%", fig.cap="<br><br>**Figure** **1**: shows the general trial types on the left and image presentation effects effets on the right"}


summary_stats_participant_trial_type <- summarySE(data_WM_long_V2, measurevar = "accuracy", groupvars = c("trial_type_new","participant"),na.rm = T)
summary_study_level_trial_type <- summarySE(summary_stats_participant_trial_type, measurevar = "accuracy", groupvars = c("trial_type_new"),na.rm = T)

summary_study_level_trial_type$participant <- 1

# Convert 'participant' to a factor explicitly
summary_stats_participant_trial_type$participant <- factor(summary_stats_participant_trial_type$participant)
summary_study_level_trial_type$participant <- factor(summary_study_level_trial_type$participant)


WM_trial_type_R2 <- ggplot(data = summary_stats_participant_trial_type, aes(x = factor(trial_type_new), y = accuracy, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "Y") +
  theme_light()+
  geom_point(data = summary_study_level_trial_type, aes(x = trial_type_new, y = accuracy),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_trial_type, aes(x = trial_type_new, ymin = accuracy - se, ymax = accuracy + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_trial_type, aes(x = trial_type_new, group = 1), colour = "grey", size = 0.5) +
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(0, 1)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("Percentage correct\n\n") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type_new), y = accuracy, fill = factor(trial_type_new)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "forestgreen")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "red", fill=NA, size=1))


# image presentation plot

summary_stats_participant_image_pres <- summarySE(data_WM_long_V2, measurevar = "accuracy", groupvars = c("image_presentation","participant"),na.rm = T)
summary_study_level_image_pres <- summarySE(summary_stats_participant_image_pres, measurevar = "accuracy", groupvars = c("image_presentation"),na.rm = T)
summary_study_level_image_pres$participant <- 1


#summary_stats_participant_image_pres<-summary_stats_participant_image_pres[!(summary_stats_participant_image_pres$image_presentation=="Baseline"),]
#summary_study_level_image_pres<-summary_study_level_image_pres[!(summary_study_level_image_pres$image_presentation=="Baseline"),]


# Convert 'participant' to a factor explicitly
summary_stats_participant_image_pres$participant <- factor(summary_stats_participant_image_pres$participant)
summary_study_level_image_pres$participant <- factor(summary_study_level_image_pres$participant)

level_order3 <- c('Baseline','Img1-Test1', 'Img2-Test1','Img1-Test2','Img2-Test2')

WM_image_pres_R2 <- ggplot(data = summary_stats_participant_image_pres, aes(x = factor(image_presentation, level = level_order3), y = accuracy, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "Y") +
  theme_light()+
  geom_point(data = summary_study_level_image_pres, aes(x = image_presentation, y = accuracy),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_image_pres, aes(x = image_presentation, ymin = accuracy - se, ymax = accuracy + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_image_pres, aes(x = image_presentation, group = 1), colour = "grey", size = 0.5) +
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(0.2, 1)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(image_presentation), y = accuracy, fill = factor(image_presentation)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "forestgreen")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))


ggarrange(WM_trial_type_R2, WM_image_pres_R2, 
          labels = c("Exp. conditions", "Recency effect"),
          ncol = 2, nrow = 1, widths = c(0.8, 0.9))


```

<br>
<br>
<br>

### LTM accuracy

<br>
<br>
<br>

```{r RIDER2 LTM accuracy, echo = FALSE,out.width="130%", fig.cap="<br><br>**Figure** **2**: shows the general trial types on the left and image presentation effects effets on the right"}

#data_LTM$adjust_keys_LTM.rt_numeric <- apply(data_LTM, 1, function(x) as.numeric(gsub("\\[|\\]", "", x["adjust_keys_LTM.rt"])))

# create a logical vector for filtering
#filter_vec <- (data_LTM$adjust_keys_LTM.rt_numeric <= 15)

# filter the data
#data_LTM <- data_LTM[filter_vec,]


# Here I calculate the accuracy for the transformed accuracies to also plot
# summary_stats_ltm_transformed <- summarySE(data_LTM_V2, measurevar = "accuracy_transformed", groupvars = c("trial_type","participant"),na.rm = T)
# 
# summary_study_ltm_transformed <- summarySE(data_LTM_V2, measurevar = "accuracy_transformed", groupvars = c("trial_type"),na.rm = T)
# 
# summary_study_ltm_transformed$participant <- 1


summary_stats_participant_LTM <- summarySE(data_LTM_V2, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)

summary_study_level_LTM <- summarySE(summary_stats_participant_LTM, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)

summary_study_level_LTM$participant <- 1
#summary_study_level_WB$participant <- 1

summary_stats_participant_LTM$participant <- factor(summary_stats_participant_LTM$participant)
summary_study_level_LTM$participant <- factor(summary_study_level_LTM$participant)
#summary_study_level_WB$participant <- factor(summary_study_level_WB$participant)


level_order5 <- c('Baseline', 'Test 1', 'Test 2','Never tested')

plot <- ggplot(data = summary_stats_participant_LTM, aes(x = factor(trial_type,level = level_order5), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "M") +
  theme_light() +
  geom_point(data = summary_study_level_LTM, aes(x = trial_type, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_LTM, aes(x = trial_type, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_LTM, aes(x = trial_type, group = 1), colour = "grey", size = 0.5)+
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "Experimental condition"  # Add a new x-axis title at the bottom
  ) +
  ylab("angular difference") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type), y = accuracy_ltm, fill = factor(trial_type)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "steelblue")+geom_vline(xintercept=3.8)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "red", fill=NA, size=1))

# Image effect subplot
summary_stats_participant_LTM_ip <- summarySE(data_LTM_V2, measurevar = "accuracy_ltm", groupvars = c("image_presentation","participant"),na.rm = T)
summary_study_level_ip <- summarySE(summary_stats_participant_LTM_ip, measurevar = "accuracy_ltm", groupvars = c("image_presentation"),na.rm = T)

summary_study_level_ip$participant <- 1

#summary_stats_participant_LTM_ip<-summary_stats_participant_LTM_ip[!(summary_stats_participant_LTM_ip$image_presentation=="Baseline"),]
#summary_study_level_ip<-summary_study_level_ip[!(summary_study_level_ip$image_presentation=="Baseline"),]

summary_stats_participant_LTM_ip$participant <- factor(summary_stats_participant_LTM_ip$participant)
summary_study_level_ip$participant <- factor(summary_study_level_ip$participant)


level_order4 <- c('Baseline','Img1-Test1', 'Img2-Test1', 'Img1-Test2','Img2-Test2','Img1-NT','Img2-NT')


plot_ip <- ggplot(data = summary_stats_participant_LTM_ip, aes(x = factor(image_presentation,level = level_order4), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "M") +
  theme_light() +
  geom_point(data = summary_study_level_ip, aes(x = image_presentation, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_ip, aes(x = image_presentation, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_ip, aes(x = image_presentation, group = 1), colour = "grey", size = 0.5) +
  geom_line(data = summary_study_level_ip, aes(x = image_presentation, group = 1),  colour = "grey", size =0.6 )+
  scale_y_reverse()+
  ylim(c(115,20)) +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = ""  # Add a new x-axis title at the bottom
  ) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(image_presentation), y = accuracy_ltm, fill = factor(image_presentation)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "steelblue")+geom_vline(xintercept=5.8)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
  )



#plot_ip

ggarrange(plot, plot_ip, 
          labels = c("Exp. condition", "Primacy effect in LTM"),
          ncol = 2, nrow = 1, widths = c(0.8, 1.1))
```

<br>
<br>
<br>
Here shown is again the WM accuracy first and then the original and transformed accuracies for direct comparison of task performance.
<br>
<br>
<br>

##### Working Memory

```{r RIDER2 LTM transformed  accuracy, echo = FALSE, fig.cap="<br><br>**Figures**: for comparison, these figures show accuracies as percentage correct for WM on top and LTM (transformed accuracies) at the bottom"}
# To plot a second y-axis 
# Transform values in degrees to [0 1] scale to make them comparable to the WM accuracy measures

min_accuracy <- 0
max_accuracy <- 180

# Define the corresponding values for the transformed range [0, 1]
min_transformed <- 1
max_transformed <- 0

# Calculate the slope 'b' and intercept 'a' for the linear transformation
b <- (max_transformed - min_transformed) / (max_accuracy - min_accuracy)
a <- min_transformed - b * min_accuracy

# Define a function to transform accuracy values to the desired range
transform_to_range <- function(x) {
  transformed <- a + b * x
  return(transformed)
}

# inv_b <- 1 / b
# inv_a <- -a / b
# 
# # Define the scale function to transform back to original accuracy values
# scale_function <- function(x) {
#   original_value <- inv_a + inv_b * x
#   return(original_value)
# }
summary_stats_participant_LTM$accuracy_transformed <- NA

summary_stats_participant_LTM$accuracy_transformed <- transform_to_range(summary_stats_participant_LTM$accuracy_ltm)


fig <- summary_stats_participant_LTM %>%
  plot_ly(
    x = ~trial_type,
    y = ~accuracy_ltm,
    split = ~trial_type,
    type = 'violin',
    side = 'negative',
    box = list(
      visible = T
    ),
    meanline = list(
      visible = T
    )
  ) 


ay <- list(
  tickfont = list(color = "purple"),
  overlaying = "y",
  side = "right",
  title = "<b>percentage correct</b>")

fig <- fig %>% add_trace(x = ~trial_type, y = ~accuracy_transformed, name = "transformed accuracies", yaxis = "y2", type = "violin", side = 'positive',color = I("purple"))


fig <- fig %>% layout(
  title = "Angular difference and transformed accuracies (% correct)", yaxis2 = ay,
  legend = list(x = 1.3, y = 1),
  xaxis = list(title="Exp. condition"),
  yaxis = list(title="<b>angular difference</b>(in °)")
)%>%
  layout(plot_bgcolor='white',
          xaxis = list(
            zerolinecolor = '#ffff',
            zerolinewidth = 2,
            gridcolor = 'ffff'),
          yaxis = list(
            zerolinecolor = '#ffff',
            zerolinewidth = 2,
            gridcolor = 'ffff',
            autorange="reversed")
          )


plotly_obj <- ggplotly(WM_trial_type_R2)

new_y_lim <- c(0.25, 1)  # Set your desired y-axis limits here
plotly_obj <- plotly_obj %>%
  layout(yaxis = list(range = new_y_lim))

#plotly_obj

fig

```

<br>
<br>
<br>

### Mnemonic distance
In the following plots we see WM and LTM accuracy as a function of mnemonic distance, fitted slope of mean data.
In the LTM task our individual slopes appear to be sig. different from 0.

<br>
<br>
<br>
```{r mnemonic distance RIDER2, echo=FALSE, out.width="130%", fig.cap="<br><br>**Figure** **4**: mnemonic distance linear slopes for WM on the left and LTM in the right."}

summary_stats_participant_md <- summarySE(data_WM_long_V2, measurevar = "accuracy", groupvars = c("mnemonic_dis","participant"),na.rm = T)

summary_study_level_md <- summarySE(summary_stats_participant_md, measurevar = "accuracy", groupvars = c("mnemonic_dis"),na.rm = T)

summary_stats_participant_md<-summary_stats_participant_md[!(summary_stats_participant_md$mnemonic_dis=="Baseline"),]

level_order7 <- c('Image 2-Test 1', 'Image 1-Test 1','Image 2-Test 2','Image 1-Test 2')

mnem_dis_WM <- ggplot(data = summary_stats_participant_md, aes(x = factor(mnemonic_dis, level = level_order7), y = accuracy)) +
  # individual points coloured by mnemonic distance
  geom_point(aes(color = factor(mnemonic_dis), fill = factor(mnemonic_dis)), size = 1.7, alpha = 0.5, position = position_jitter(width = 0.06, height = 0), show.legend = FALSE) +
  # mean points coloured by mnemonic distance
  geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.4, colour = "grey") +
  # smooth line
  geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.1, colour = "brown") +
  # violin plot
  geom_flat_violin(aes(fill = factor(mnemonic_dis)), alpha = 0.5, position = position_nudge(x = 0.15)) +
  # population mean dots
  stat_summary(fun.data = mean_cl_normal, geom = "point", size = 3, shape = 21, fill = "brown", color = "black") +
  # dashed line at y = 0
  geom_hline(yintercept = 0.6840637, linetype = "dashed", color = "brown") +
  # mean and SE line
  geom_smooth(method = "glm", se = T, aes(group = 1), color = "brown", size = 1.5) +
  # axis labels and title
  xlab("") +
  ylab("Percentage correct\n\n") +
  labs(title = "") +
  # fill and color schemes
  scale_fill_manual(values = c("#FFE0B2", "#DAA520","#FFF5EB","#FFD700"), name = "Mnemonic distance") +
  scale_color_manual(values = c("#FFE0B2", "#DAA520","#FFF5EB","#FFD700"), name = "Mnemonic distance") + # set dots color to the same violin fill color # set smooth line and mean point color to orange shades
  # theme settings
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
  )


# LTM plot 



summary_stats_participant_LTM_md <- summarySE(data_LTM_V2, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)
summary_study_level_LTM_md <- summarySE(summary_stats_participant_LTM_md, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss"),na.rm = T)

summary_stats_participant_LTM_md<-summary_stats_participant_LTM_md[!(summary_stats_participant_LTM_md$mnemonic_diss=="Never tested"),]
summary_stats_participant_LTM_md<-summary_stats_participant_LTM_md[!(summary_stats_participant_LTM_md$mnemonic_diss=="Baseline"),]

level_order8 <- c('Image 2- Test 1', 'Image 1- Test 1','Image 2- Test 2','Image 1- Test 2')

mnem_dis_LTM <- ggplot(data = summary_stats_participant_LTM_md, aes(x = factor(mnemonic_diss, level = level_order8), y = accuracy_ltm)) +
  # individual points coloured by mnemonic distance
  geom_point(aes(color = factor(mnemonic_diss)), size = 1.7, alpha = 0.5, fill = "grey", position = position_jitter(width = 0.06, height = 0), show.legend = FALSE) +
  # mean points coloured by mnemonic distance
  geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.4, colour = "grey") +
  # smooth line
  geom_line(stat = "smooth", method = "glm", size = 0.6, alpha = 0.1, colour = "brown") +
  # violin plot
  geom_flat_violin(aes(fill = factor(mnemonic_diss)), alpha = 0.5, position = position_nudge(x = 0.15)) +
  # population mean dots
  stat_summary(fun.data = mean_cl_normal, geom = "point", size = 3, shape = 21, fill = "red", color = "black") +
  # dashed line at y = 0
  geom_hline(yintercept = 71.39774, linetype = "dashed", color = "red") +
  # mean and SE line
  geom_smooth(method = "glm", se = T, aes(group = 1), color = "brown", size = 1.5) +
  scale_y_reverse()+
  # axis labels and title
  xlab("") +
  ylab("mean absolut error") +
  labs(title = "") +
  # fill and color schemes
  scale_fill_manual(values = c("#FF5733","#E74C3C", "#FFC6B2","#FF0000"), name = "Mnemonic distance") +
  scale_color_manual(values = c("#FF5733","#E74C3C", "#FFC6B2","#FF0000"), name = "Mnemonic distance") + # set dots color to orange shades
  # theme settings
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
  )



ggarrange(mnem_dis_WM, mnem_dis_LTM, 
          labels = c("WM", "LTM"),
          ncol = 2, nrow = 1, widths = c(0.8, 0.8))


```
<br>
<br>
<br>
These are the following t-tests against a 0 slope first for WM (not significant) and second for LTM (significant):
<br>
<br>
<br>
```{r mnemonic distance regression RIDER2, echo=FALSE}
# linear fit calculations and t-tests against 0 slope 

data_WM_long_reg_V2<-filter(data_WM_long_V2, !(mnemonic_dis == "Baseline") )

#recode variables for regression analysis
data_WM_long_reg_V2$mnemonic_dis[data_WM_long_reg_V2$mnemonic_dis == 'Image 2-Test 1'] <- 0
data_WM_long_reg_V2$mnemonic_dis[data_WM_long_reg_V2$mnemonic_dis == 'Image 1-Test 1'] <- 1
data_WM_long_reg_V2$mnemonic_dis[data_WM_long_reg_V2$mnemonic_dis == 'Image 2-Test 2'] <- 2
data_WM_long_reg_V2$mnemonic_dis[data_WM_long_reg_V2$mnemonic_dis == 'Image 1-Test 2'] <- 3

data_WM_long_reg_V2$mnemonic_dis <- as.numeric(data_WM_long_reg_V2$mnemonic_dis)

linear_fit_V2 <- summarySE(data_WM_long_reg_V2, measurevar = "accuracy", groupvars = c("mnemonic_dis","participant"),na.rm = T)

linear_fit <- group_by(linear_fit_V2, participant) %>% summarize(b0 = coef(glm(accuracy ~ mnemonic_dis))[1],
                                b1 = coef(glm(accuracy ~ mnemonic_dis))[2])


# gghistogram(linear_fit, x = "b1", y = "..density..", fill = "#FFA07A",add_density = TRUE,ggtheme = theme_minimal())+xlab("\nSlopes")+ylab("Density\n")+
#   labs(title = 'Slopes of liear fit on individual subject level (WM task)')+
#   theme(plot.title = element_text(hjust = 0.5))

t_test <- t.test(linear_fit$b1, mu = 0)

t_test


# regression for LTM
data_LTM_reg_V2<-filter(data_LTM_V2, !(mnemonic_diss == "Baseline") )
data_LTM_reg_V2<-data_LTM_reg_V2[!(data_LTM_reg_V2$mnemonic_diss=="Never tested"),]

#recode variables for regression analysis
data_LTM_reg_V2$mnemonic_diss[data_LTM_reg_V2$mnemonic_diss == 'Image 2- Test 1'] <- 0
data_LTM_reg_V2$mnemonic_diss[data_LTM_reg_V2$mnemonic_diss == 'Image 1- Test 1'] <- 1
data_LTM_reg_V2$mnemonic_diss[data_LTM_reg_V2$mnemonic_diss == 'Image 2- Test 2'] <- 2
data_LTM_reg_V2$mnemonic_diss[data_LTM_reg_V2$mnemonic_diss == 'Image 1- Test 2'] <- 3

data_LTM_reg_V2$mnemonic_diss <- as.numeric(data_LTM_reg_V2$mnemonic_diss)

linear_fit_LTM_V2 <- summarySE(data_LTM_reg_V2, measurevar = "accuracy_ltm", groupvars = c("mnemonic_diss","participant"),na.rm = T)

linear_fit_LTM_V2 <- group_by(linear_fit_LTM_V2, participant) %>% summarize(b0 = coef(glm(accuracy_ltm ~ mnemonic_diss))[1],
                                b1 = coef(glm(accuracy_ltm ~ mnemonic_diss))[2])


# gghistogram(linear_fit_LTM_V2, x = "b1", y = "..density..", fill = "#FFA07A",add_density = TRUE,ggtheme = theme_minimal())+xlab("\nSlopes")+ylab("Density\n")+
#   labs(title = 'Slopes of liear fit on individual subject level (LTM task)')+
#   theme(plot.title = element_text(hjust = 0.5))


t_test_slopes_LTM_V2 <- t.test(linear_fit_LTM_V2$b1, mu = 0)

t_test_slopes_LTM_V2

linear_fit_LTM_V2$test <- "LTM"
linear_fit$test <- "WM"

linear_fit <- rbind(linear_fit_LTM_V2,linear_fit)

print("Here we test the slopes against each other (WM vs. LTM)")

linear_fit<-filter(linear_fit, !(participant == 89) )

t_test_task_slopes<- linear_fit %>%
   pairwise_t_test(
    b1 ~ test, paired = TRUE)

t_test_task_slopes
```

### In the following I am repeating the analysis for only the trials where participants answered correctly

br>
```{r correct trials (RIDER2 pruning), echo=FALSE}

correct_trials <- data_WM_long_V2 %>%
  filter(accuracy == 0)

correct_trials <- correct_trials %>%
  group_by(participant,trial_type_new)%>%
  summarise(test1,test2)

correct_trials<- correct_trials %>% pivot_longer(cols=c('test1', 'test2'),names_to='Presentation',values_to='image', names_repair = "unique") 

correct_trials <- correct_trials %>%
  rowwise()%>%
  mutate(delete = case_when(trial_type_new == "Test 1" & Presentation == "test2"  ~ "delete",
                            trial_type_new == "Test 2" & Presentation == "test1"  ~ "delete",
                            trial_type_new == "Test 1" & Presentation == "test1"  ~ "no_delete",
                            trial_type_new == "Test 2" & Presentation == "test2"  ~ "no_delete",
                            trial_type_new == "Baseline" & Presentation == "test2"  ~ "delete",
                            trial_type_new == "Baseline" & Presentation == "test1"  ~ "no_delete"))

correct_trials<-correct_trials[(correct_trials$delete== "no_delete"),]


# identification of ltm object pool that includes only pruned WM conditions (Test 1 and Test 2 is effected here)
data_LTM_V2 <- rbind.fill(data_LTM_V2,correct_trials[c("participant", "image")])

data_LTM <- data_LTM %>%
  group_by(participant)%>%
  mutate(matching = case_when(ltm_image %in% image1  ~ "Match",
                              ltm_image %notin%  image1  ~   "NO_Match"))


data_LTM <- data_LTM[rowSums(is.na(data_LTM)) == 1|rowSums(is.na(data_LTM)) == 2|rowSums(is.na(data_LTM)) == 3|rowSums(is.na(data_LTM)) == 4,]

# delete all matching trials in ltm dataframe
data_LTM_pruned<-data_LTM[!(data_LTM$matching=="Match"),]

data_LTM$pruned <- "NO"
data_LTM_pruned$pruned <-"YES"


LTM <- rbind(data_LTM,data_LTM_pruned)






<br>
<br>
<br>
<br>
<br>
<br>

```{r accuracy calculation RIDER3, echo=FALSE}


data_WM_V3<-data_WM_V3[!(data_WM_V3$participant==63),]
data_LTM_V3<-data_LTM_V3[!(data_LTM_V3$participant==63),]

#data_WM_V3<-data_WM_V3[!(data_WM_V3$participant==32),]
#data_LTM_V3<-data_LTM_V3[!(data_LTM_V3$participant==32),]

# removing timeout trials from LTM
#data_LTM_V3 <- data_LTM_V3[!(as.character(data_LTM_V3$timeout_ltm) == "1"), ]

# Group the data by participant and remove the first 6 trials for each participant
data_WM_V3 <- data_WM_V3 %>%
  group_by(participant) %>%
  slice(7:n()) %>%
  ungroup()

# Identify the row indices that have been deleted
practice_trials <- data_WM_V3 %>%
  group_by(participant) %>%
  slice(1:6)


#calculating the correct fixed orientations for the 2-item trials:
#depending on whether the stimulus was presented in image 1 or image 2

data_WM_V3$startOri1 <- as.character(data_WM_V3$startOri1)

# here I determine the orientation the test image was presented in and give it the name fixedOri_t1
data_WM_V3 <- data_WM_V3 %>%
  rowwise() %>%
  mutate(
    fixedOri_t1 = case_when(
      test1 == image1 ~ as.numeric(startOri1),
      test1 == image2 ~ as.numeric(startOri2),
      TRUE ~ NA_real_
    )
  )
# calculate remainder of this_ori variable to adjust for cases that are beyond 360 degrees
data_WM_V3 <- data_WM_V3 %>% mutate(ori_t1_corrected = this_ori_t1 %% 360)#Modulus (Remainder from division)


data_WM_V3$fixedOri_t1 <- as.numeric(data_WM_V3$fixedOri_t1)


# calculating accuracy for test 1 and test 2
# function

angdiff <- function(alpha_deg, beta_deg) {
  #The function assumes that the input angles alpha and beta are in radians.So, you will have to convert them to radians first:
  alpha_rad <- alpha_deg * pi / 180
  beta_rad <- beta_deg * pi / 180
  # Then, you calculate the difference in angles
  delta_rad <- alpha_rad - beta_rad
  # If your input angles alpha and beta are larger than 360°, the mod() function will correctly wrap them to the range of [-180,180] degrees interval.
  delta_rad <- (delta_rad + pi) %% (2*pi) - pi
  delta_deg <- delta_rad * 180 / pi
  #the function outputs both the angular difference in degrees and in radians
  return(list(delta_rad = delta_rad, delta_deg = delta_deg))
}

# accuracy in radians
data_WM_V3$accuracy_t1_rad <- apply(data_WM_V3[,c("this_ori_t1", "fixedOri_t1")], 1, function(x) angdiff(x[1], x[2])$delta_rad)

# accuracy in degrees
data_WM_V3$accuracy_t1 <- abs(apply(data_WM_V3[,c("this_ori_t1", "fixedOri_t1")], 1, function(x) angdiff(x[1], x[2])$delta_deg))


# calculate ltm accuracy
data_LTM_V3 <- data_LTM_V3 %>% mutate(ori_ltm = this_ori_ltm %% 360)#Modulus (Remainder from division)


# calculating accuracy for LTM test

data_LTM_V3 <- data_LTM_V3 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm -fixedOri_ltm))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm -fixedOri_ltm))

data_LTM_V3 <- transform(data_LTM_V3, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference



data_LTM_V3$accuracy_ltm_rad <- (apply(data_LTM_V3[,c("this_ori_ltm", "fixedOri_ltm")], 1, function(x) angdiff(x[1], x[2])$delta_rad))


```


```{r renaming trial types RIDER3, echo=FALSE}
data_WM_V3 <- data_WM_V3  %>% 
  mutate(trial_type_new = case_when(
    trial_type == "attended_1" ~ "attended",
    trial_type == "attended_2" ~ "attended",
    trial_type == "attended_3" ~ "attended",
    trial_type == "attended_4" ~ "attended",
    trial_type == "attended_5" ~ "attended",
    trial_type == "unattended" ~ "unattended"))


data_WM_V3 <- data_WM_V3  %>% 
  mutate(image_effect = case_when(
    trial_type == "attended_1" & image1 %in%  test1 ~ "Image1-attended",
    trial_type == "attended_1" & image2 %in%  test1 ~ "Image2-attended",
    trial_type == "attended_2" & image1 %in%  test1 ~ "Image1-attended",
    trial_type == "attended_2" & image2 %in%  test1 ~ "Image2-attended",
    trial_type == "attended_3" & image1 %in%  test1 ~ "Image1-attended",
    trial_type == "attended_3" & image2 %in%  test1 ~ "Image2-attended",
    trial_type == "attended_4" & image1 %in%  test1 ~ "Image1-attended",
    trial_type == "attended_4" & image2 %in%  test1 ~ "Image2-attended",
    trial_type == "attended_5" & image1 %in%  test1 ~ "Image1-attended",
    trial_type == "attended_5" & image2 %in%  test1 ~ "Image2-attended",
    trial_type == "unattended" & image1 %in%  test1 ~ "Image1-unattended",
    trial_type == "unattended" & image2 %in%  test1 ~ "Image2-unattended",))

data_LTM_V3 <- rbind.fill(data_LTM_V3,data_WM_V3[c("test1","participant","image1","image2")])

data_LTM_V3 <- data_LTM_V3 %>%
  group_by(participant)%>%
  mutate(trial_type = case_when(ltm_trial == 'attended_1' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_2' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_3' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_4' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_5' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'unattended' & ltm_image %in%  test1 ~ "unattended",
                                 ltm_trial == 'unattended' & ltm_image %notin% test1  ~ "attended-never tested",
                                 ltm_trial == 'attended_1' & ltm_image %notin% test1  ~ "unattended-never tested",
                                 ltm_trial == 'attended_2' & ltm_image %notin% test1  ~ "unattended-never tested",
                                 ltm_trial == 'attended_3' & ltm_image %notin% test1  ~ "unattended-never tested",
                                 ltm_trial == 'attended_4' & ltm_image %notin% test1  ~ "unattended-never tested",
                                 ltm_trial == 'attended_5' & ltm_image %notin% test1  ~ "unattended-never tested"))

data_LTM_V3 <- data_LTM_V3 %>%
  group_by(participant)%>%
  mutate(attention = case_when(ltm_trial == 'attended_1' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_2' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_3' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_4' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'attended_5' & ltm_image %in%  test1 ~ "attended",
                                 ltm_trial == 'unattended' & ltm_image %in%  test1 ~ "unattended",
                                 ltm_trial == 'unattended' & ltm_image %notin% test1  ~ "attended",
                                 ltm_trial == 'attended_1' & ltm_image %notin% test1  ~ "unattended",
                                 ltm_trial == 'attended_2' & ltm_image %notin% test1  ~ "unattended",
                                 ltm_trial == 'attended_3' & ltm_image %notin% test1  ~ "unattended",
                                 ltm_trial == 'attended_4' & ltm_image %notin% test1  ~ "unattended",
                                 ltm_trial == 'attended_5' & ltm_image %notin% test1  ~ "unattended"))

data_LTM_V3 <- data_LTM_V3 %>%
  group_by(participant)%>%
  mutate(testing = case_when(ltm_trial == 'attended_1' & ltm_image %in%  test1 ~ "tested",
                                 ltm_trial == 'attended_2' & ltm_image %in%  test1 ~ "tested",
                                 ltm_trial == 'attended_3' & ltm_image %in%  test1 ~ "tested",
                                 ltm_trial == 'attended_4' & ltm_image %in%  test1 ~ "tested",
                                 ltm_trial == 'attended_5' & ltm_image %in%  test1 ~ "tested",
                                 ltm_trial == 'unattended' & ltm_image %in%  test1 ~ "tested",
                                 ltm_trial == 'unattended' & ltm_image %notin% test1  ~ "not-tested",
                                 ltm_trial == 'attended_1' & ltm_image %notin% test1  ~ "not-tested",
                                 ltm_trial == 'attended_2' & ltm_image %notin% test1  ~ "not-tested",
                                 ltm_trial == 'attended_3' & ltm_image %notin% test1  ~ "not-tested",
                                 ltm_trial == 'attended_4' & ltm_image %notin% test1  ~ "not-tested",
                                 ltm_trial == 'attended_5' & ltm_image %notin% test1  ~ "not-tested"))


# data_LTM <- data_LTM %>%
#   group_by(participant)%>%
#   mutate(trial_type = case_when(ltm_trial == 'attended_1' & ltm_image %in%  test1 ~ "attended",
#                                  ltm_trial == 'attended_2' & ltm_image %in%  test1 ~ "attended",
#                                  ltm_trial == 'attended_3' & ltm_image %in%  test1 ~ "attended",
#                                  ltm_trial == 'unattended' & ltm_image %in%  test1 ~ "unattended",
#                                  ltm_trial == 'unattended' & ltm_image %notin% test1  ~ "never tested",
#                                  ltm_trial == 'attended_1' & ltm_image %notin% test1  ~ "never tested",
#                                  ltm_trial == 'attended_2' & ltm_image %notin% test1  ~ "never tested",
#                                  ltm_trial == 'attended_3' & ltm_image %notin% test1  ~ "never tested"))

data_LTM_V3 <- data_LTM_V3 %>%
  group_by(participant)%>%
  mutate(image_effect = case_when(ltm_trial == 'attended_1' & ltm_image %in%  test1 & ltm_image %in%  image1 ~ "Image1-attended",
                                  ltm_trial == 'attended_2' & ltm_image %in%  test1 & ltm_image %in%  image1 ~ "Image1-attended",
                                  ltm_trial == 'attended_3' & ltm_image %in%  test1 & ltm_image %in%  image1 ~ "Image1-attended",
                                  ltm_trial == 'attended_1' & ltm_image %in%  test1 & ltm_image %in%  image2 ~ "Image2-attended",
                                  ltm_trial == 'attended_2' & ltm_image %in%  test1 & ltm_image %in%  image2 ~ "Image2-attended",
                                  ltm_trial == 'attended_3' & ltm_image %in%  test1 & ltm_image %in%  image2 ~ "Image2-attended",
                                  ltm_trial == 'attended_4' & ltm_image %in%  test1 & ltm_image %in%  image2 ~ "Image2-attended",
                                  ltm_trial == 'attended_5' & ltm_image %in%  test1 & ltm_image %in%  image2 ~ "Image2-attended",
                                  ltm_trial == 'attended_4' & ltm_image %in%  test1 & ltm_image %in%  image1 ~ "Image1-attended",
                                  ltm_trial == 'attended_5' & ltm_image %in%  test1 & ltm_image %in%  image1 ~ "Image1-attended",
                                  ltm_trial == 'unattended' & ltm_image %in%  test1 & ltm_image %in%  image1 ~ "Image1-unattended",
                                  ltm_trial == 'unattended' & ltm_image %in%  test1 & ltm_image %in%  image2 ~ "Image2-unattended",
                                  ltm_trial == 'unattended' & ltm_image %notin% test1 & ltm_image %in%  image2 ~ "Image2-attended-never tested",
                                  ltm_trial == 'unattended' & ltm_image %notin% test1 & ltm_image %in%  image1 ~ "Image1-attended-never tested",
                                  ltm_trial == 'attended_1' & ltm_image %notin% test1 & ltm_image %in%  image2 ~ "Image2-unattended-never tested",
                                  ltm_trial == 'attended_1' & ltm_image %notin% test1 & ltm_image %in%  image1 ~ "Image1-unattended-never tested",
                                  ltm_trial == 'attended_2' & ltm_image %notin% test1 & ltm_image %in%  image2 ~ "Image2-unattended-never tested",
                                  ltm_trial == 'attended_2' & ltm_image %notin% test1 & ltm_image %in%  image1 ~ "Image1-unattended-never tested",
                                  ltm_trial == 'attended_3' & ltm_image %notin% test1 & ltm_image %in%  image2 ~ "Image2-unattended-never tested",
                                  ltm_trial == 'attended_3' & ltm_image %notin% test1 & ltm_image %in%  image1 ~ "Image1-unattended-never tested",
                                  ltm_trial == 'attended_4' & ltm_image %notin% test1 & ltm_image %in%  image2 ~ "Image2-unattended-never tested",
                                  ltm_trial == 'attended_4' & ltm_image %notin% test1 & ltm_image %in%  image1 ~ "Image1-unattended-never tested",
                                  ltm_trial == 'attended_5' & ltm_image %notin% test1 & ltm_image %in%  image2 ~ "Image2-unattended-never tested",
                                  ltm_trial == 'attended_5' & ltm_image %notin% test1 & ltm_image %in%  image1 ~ "Image1-unattended-never tested"))



#remove extra WM rows again
data_LTM_V3 <- data_LTM_V3[rowSums(is.na(data_LTM_V3)) == 0|rowSums(is.na(data_LTM_V3)) == 1| rowSums(is.na(data_LTM_V3)) == 2|rowSums(is.na(data_LTM_V3)) == 3|rowSums(is.na(data_LTM_V3)) == 4,]


filtered_df <- data_LTM_V3 %>%
  filter(participant >= 1 & participant <= 47)



count_above_15 <- filtered_df %>%
  filter((timeout_ltm) == "1") %>%
  nrow()

total_participants <- 47
trials_per_participant <- 112
# 
# # Calculate the average number of trials per participant
average_trials_per_participant <- count_above_15 / total_participants
# 
# # Calculate the percentages
average_percentage <- (average_trials_per_participant / trials_per_participant) * 100
# 
# # Calculate the minimum and maximum percentages
min_percentage <- (0 / trials_per_participant) * 100
max_percentage <- (4.76 / trials_per_participant) * 100
# 
# # Format the result
result <- sprintf("%.2f%% of trials on average; min = %.2f%%, max = %.2f%%", 
                  average_percentage, min_percentage, max_percentage)

cat(result)







timeout_WM <- data_WM_V3 %>% filter(is.na(adjust_keys_t1.rt))



data_LTM_V3 <- data_LTM_V3[!(as.character(data_LTM_V3$timeout_ltm) == "1"), ]



```


```{r WM Bias RIDER3, include=FALSE}
# extract data for WM bias in attended over participants
test_2_data2_V3 <- subset(data_LTM_V3, trial_type == "attended", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))

test_2_data_WM2_V3 <- subset(data_WM_V3, trial_type_new == "attended", select = c("participant","test1","ori_t1_corrected"))

test_2_data2_V3 <- rbind.fill(test_2_data2_V3,test_2_data_WM2_V3[c("participant","test1","ori_t1_corrected")])

test2_trials2_V3 <-split(test_2_data2_V3,test_2_data2_V3$participant)

for(df in 1:length(test2_trials2_V3)) {
  test2_trials2_V3[[df]]$alternative_memory_V3 <- sapply(test2_trials2_V3[[df]]$ltm_image,function(x) test2_trials2_V3[[df]]$ori_t1_corrected[grep(x,test2_trials2_V3[[df]]$test1)[1]])
}

test_2_data2_V3 <- rbindlist(test2_trials2_V3)

test_2_data2_V3 <- test_2_data2_V3 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory_V3))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory_V3))

test_2_data2_V3 <- transform(test_2_data2_V3, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# extract data for WM bias in unattended over participants

test_1_data2_V3 <- subset(data_LTM_V3, trial_type == "unattended", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))

test_1_data_WM2_V3 <- subset(data_WM_V3, trial_type_new == "unattended", select = c("participant","test1","ori_t1_corrected"))

test_1_data2_V3 <- rbind.fill(test_1_data2_V3,test_1_data_WM2_V3[c("participant","test1","ori_t1_corrected")])

test1_trials2_V3 <-split(test_1_data2_V3,test_1_data2_V3$participant)

for(df in 1:length(test1_trials2_V3)) {
  test1_trials2_V3[[df]]$alternative_memory_V3 <- sapply(test1_trials2_V3[[df]]$ltm_image,function(x) test1_trials2_V3[[df]]$ori_t1_corrected[grep(x,test1_trials2_V3[[df]]$test1)[1]])
}


test_1_data2_V3 <- rbindlist(test1_trials2_V3)


test_1_data2_V3 <- test_1_data2_V3 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory_V3))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory_V3))

test_1_data2_V3 <- transform(test_1_data2_V3, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# add trials type 
test_1_data2_V3$trial_type <- "unattended"
test_2_data2_V3$trial_type <- "attended"

alternative_ltm_V3 <- rbind(test_1_data2_V3,test_2_data2_V3)

summary_stats_participant_WB_V3 <- summarySE(alternative_ltm_V3, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_WB_V3 <- summarySE(summary_stats_participant_WB_V3, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)


```

<h3 style="text-align: center; color: blue;">**RIDER 3**</h3>
In the following we see the results for the last experiment of the RIDER series, a more classical retrocue paradigm.


## Visualisation RIDER 3
### WM accuracy

<br>
<br>
<br>
```{r Visualisations RIDER3, echo=FALSE,out.width="130%"}

summary_stats_participant_trial_type_V3 <- summarySE(data_WM_V3, measurevar = "accuracy_t1", groupvars = c("trial_type_new","participant"),na.rm = T)
summary_study_level_trial_type_V3 <- summarySE(summary_stats_participant_trial_type_V3, measurevar = "accuracy_t1", groupvars = c("trial_type_new"),na.rm = T)
summary_study_level_trial_type_V3$participant <- 1

# Convert 'participant' to a factor explicitly
summary_stats_participant_trial_type_V3$participant <- factor(summary_stats_participant_trial_type_V3$participant)
summary_study_level_trial_type_V3$participant <- factor(summary_study_level_trial_type_V3$participant)


WM_trials_V3 <- ggplot(data = summary_stats_participant_trial_type_V3, aes(x = factor(trial_type_new), y = accuracy_t1, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "C") +
  theme_light()+
  geom_point(data = summary_study_level_trial_type_V3, aes(x = trial_type_new, y = accuracy_t1),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_trial_type_V3, aes(x = trial_type_new, ymin = accuracy_t1 - se, ymax = accuracy_t1 + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_trial_type_V3, aes(x = trial_type_new, group = 1), colour = "grey", size = 0.5) +
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(70,-5)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("Angular difference (in °)\n\n") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type_new), y = accuracy_t1, fill = factor(trial_type_new)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FFA500")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "red", fill=NA, size=1))

# image presentation plot

summary_stats_participant_image_pres <- summarySE(data_WM_V3, measurevar = "accuracy_t1", groupvars = c("image_effect","participant"),na.rm = T)
summary_study_level_image_pres <- summarySE(summary_stats_participant_image_pres, measurevar = "accuracy_t1", groupvars = c("image_effect"),na.rm = T)
summary_study_level_image_pres$participant <- 1


# Convert 'participant' to a factor explicitly
summary_stats_participant_image_pres$participant <- factor(summary_stats_participant_image_pres$participant)
summary_study_level_image_pres$participant <- factor(summary_study_level_image_pres$participant)


level_order9 <- c('Image1-attended', 'Image2-attended','Image1-unattended','Image2-unattended') 


 WM_img_eff_V3 <-ggplot(data = summary_stats_participant_image_pres, aes(x = factor(image_effect, level = level_order9), y = accuracy_t1, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "C") +
  theme_light()+
  geom_point(data = summary_study_level_image_pres, aes(x = image_effect, y = accuracy_t1),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_image_pres, aes(x = image_effect, ymin = accuracy_t1 - se, ymax = accuracy_t1 + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_image_pres, aes(x = image_effect, group = 1), colour = "grey", size = 0.5) +
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(70,-5)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(image_effect), y = accuracy_t1, fill = factor(image_effect)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FFA500")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))


ggarrange(WM_trials_V3 , WM_img_eff_V3, 
          labels = c("attended vs. unattended", "Recency effect"),
          ncol = 2, nrow = 1, widths = c(0.9, 0.9))



```


```{r pairwise t-test WM RIDER3, echo=FALSE}
print("The following pairwise t-test tests the difference between attended and unattended storage in WM")

full_data_summary <-data_WM_V3 %>%
  group_by(trial_type_new, participant) %>%
  get_summary_stats(accuracy_t1, type = "mean_sd")


full_data_summary %>%
  pairwise_t_test(
    mean ~ trial_type_new, paired = TRUE,
    p.adjust.method = "holm")

full_data_summary <-data_LTM_V3 %>%
  group_by(image_effect, participant) %>%
  get_summary_stats(accuracy_ltm, type = "mean_sd")


full_data_summary %>%
  pairwise_t_test(
    mean ~ image_effect, paired = TRUE,
    p.adjust.method = "holm")





```



<br>
<br>
<br>

### LTM accuracy

<br>
<br>
<br>

```{r RIDER3 LTM accuracy, echo = FALSE,out.width="130%", fig.cap="<br><br>**Figure** **5**: shows the general trial types on the left and image presentation effects effets on the right"}


summary_stats_participant_LTM_V3 <- summarySE(data_LTM_V3, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_LTM_V3 <- summarySE(summary_stats_participant_LTM_V3, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)
summary_study_level_LTM_V3$participant <- 1
summary_study_level_WB_V3$participant <- 1

summary_stats_participant_LTM_V3$participant <- factor(summary_stats_participant_LTM_V3$participant)
summary_study_level_LTM_V3$participant <- factor(summary_study_level_LTM_V3$participant)
summary_study_level_WB_V3$participant <- factor(summary_study_level_WB_V3$participant)


level_order10 <- c('attended', 'unattended','attended-never tested','unattended-never tested')


plot_V3 <- ggplot(data = summary_stats_participant_LTM_V3, aes(x = factor(trial_type,level = level_order10), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "E") +
  theme_light() +
  geom_point(data = summary_study_level_LTM_V3, aes(x = trial_type, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_LTM_V3, aes(x = trial_type, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_LTM_V3, aes(x = trial_type, group = 1), colour = "grey", size = 0.5) +
  geom_errorbar(data = summary_study_level_WB_V3, aes(x = trial_type, ymin = accuracy_ltm-se, ymax =accuracy_ltm+se), width = .15, colour = "orange", size = 0.8)+
  geom_line(data = summary_study_level_WB_V3, aes(x = trial_type, group = 1),  colour = "orange", size =0.6 )+
  scale_y_reverse()+theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "Experimental condition"  # Add a new x-axis title at the bottom
  ) +
  ylab("Angular difference (in °)") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type), y = accuracy_ltm, fill = factor(trial_type)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#440154")+geom_vline(xintercept=2.8)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "red", fill=NA, size=1))



plot_V3 <- plot_V3 +
  annotate("text", x = 0.5, y = 5, hjust = 0, vjust = 0,
           label = "grey = difference to presentation orientation", size = 3.5, color = "grey") +
  annotate("text", x = 0.5, y = 10, hjust = 0, vjust = 0,
           label = "orange = difference to WM report", size = 3.5, color = "orange")

# Add ylim to expand the y-axis range to include the annotations
plot_V3 <- plot_V3 + ylim(c(110,0))

#plot


# Image effect subplot
summary_stats_participant_LTM_ip_V3 <- summarySE(data_LTM_V3, measurevar = "accuracy_ltm", groupvars = c("image_effect","participant"),na.rm = T)
summary_study_level_ip_V3 <- summarySE(summary_stats_participant_LTM_ip_V3, measurevar = "accuracy_ltm", groupvars = c("image_effect"),na.rm = T)

summary_study_level_ip_V3$participant <- 1


summary_stats_participant_LTM_ip_V3$participant <- factor(summary_stats_participant_LTM_ip_V3$participant)
summary_study_level_ip_V3$participant <- factor(summary_study_level_ip_V3$participant)


level_order11 <- c('Image1-attended', 'Image2-attended', 'Image1-unattended','Image2-unattended','Image1-attended-never tested','Image2-attended-never tested','Image1-unattended-never tested','Image2-unattended-never tested')


plot_ip_V3 <- ggplot(data = summary_stats_participant_LTM_ip_V3, aes(x = factor(image_effect,level = level_order11), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "E") +
  theme_light() +
  geom_point(data = summary_study_level_ip_V3, aes(x = image_effect, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_ip_V3, aes(x = image_effect, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_ip_V3, aes(x = image_effect, group = 1), colour = "grey", size = 0.5) +
  geom_line(data = summary_study_level_ip_V3, aes(x = image_effect, group = 1),  colour = "grey", size =0.6 )+
  scale_y_reverse() +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = ""  # Add a new x-axis title at the bottom
  ) +
  ylab("") +
  xlab("") +
  geom_flat_violin(aes(x = factor(image_effect), y = accuracy_ltm, fill = factor(image_effect)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#440154")+geom_vline(xintercept=4.7)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)
  )


#plot_ip_V3

ggarrange(plot_V3, plot_ip_V3, 
          labels = c("Exp. condition", "Primacy effect in LTM"),
          ncol = 2, nrow = 1, widths = c(0.8, 1.1))

```

```{r pruning and WM bias RIDER3, include=FALSE}
# did not do the task 
data_WM_V3<-data_WM_V3[!(data_WM_V3$participant==63),]
data_LTM_V3<-data_LTM_V3[!(data_LTM_V3$participant==63),]

#data_WM_V3<-data_WM_V3[!(data_WM_V3$participant==32),]
#data_LTM_V3<-data_LTM_V3[!(data_LTM_V3$participant==32),]

#check for timeout trials in the WM task 
timeout_WM <- data_WM_V3 %>% filter(is.na(adjust_keys_t1.rt))

data_WM <- data_WM_V3 %>% filter(!is.na(adjust_keys_t1.rt))

objects_time_out <- timeout_WM %>%
  group_by(participant,trial_type_new)%>%
  summarise(image1,image2)


objects_time_out<- objects_time_out %>% pivot_longer(cols=c('image1', 'image2'),names_to='Presentation',values_to='image1') 

# identification of ltm object pool that includes only pruned WM conditions (Test 1 and Test 2 is effected here)
data_LTM_V3 <- rbind.fill(data_LTM_V3,objects_time_out[c("participant", "image1")])

data_LTM_V3 <- data_LTM_V3 %>%
  group_by(participant)%>%
  mutate(matching = case_when(ltm_image %in% image1  ~ "Match",
                              ltm_image %notin%  image1  ~   "NO_Match"))


data_LTM_V3 <- data_LTM_V3[rowSums(is.na(data_LTM_V3)) == 1|rowSums(is.na(data_LTM_V3)) == 2|rowSums(is.na(data_LTM_V3)) == 3|rowSums(is.na(data_LTM_V3)) == 4,]

# delete all matching trials in ltm dataframe
data_LTM_V3<-data_LTM_V3[!(data_LTM_V3$matching=="Match"),]



removed_trials <-data.frame(matrix(ncol=22,nrow=0, dimnames=list(NULL, colnames(data_WM_V3))))
data_WM_after_pruning <- data_WM_V3

######current approach
for (i in data_WM_V3$participant){
  # select trials per participant
  attended_trials <- data_WM_V3[which(data_WM_V3$trial_type_new=='attended' & data_WM_V3$participant == i), ]
  unattended_trials <- data_WM_V3[which(data_WM_V3$trial_type_new=='unattended' & data_WM_V3$participant == i), ]
  # order mean values for each trial type to know what to prune
  vector <- c(mean(attended_trials$accuracy_t1,na.rm = TRUE),mean(unattended_trials$accuracy_t1,na.rm = TRUE))
  # find the reference for pruning (will be baseline for most participants)
  lowest <- mean(vector)+2
  # order the single values to prepare to remove them to equalize the means
  attended_trials <- attended_trials[order(attended_trials$accuracy_t1,decreasing = TRUE),]
  unattended_trials <- unattended_trials[order(unattended_trials$accuracy_t1,decreasing = TRUE),]
  while (mean(attended_trials$accuracy_t1,na.rm = TRUE) > lowest){
    removed <- attended_trials[1,]
    attended_trials <- attended_trials[-1,]
    removed_trials[nrow(removed_trials) + 1, ] <- removed
  }
  while (mean(unattended_trials$accuracy_t1,na.rm = TRUE) > lowest){
    removed <- unattended_trials[1,]
    unattended_trials <- unattended_trials[-1,]
    removed_trials[nrow(removed_trials) + 1, ] <- removed
  }
  print(i)
}

removed_trials <- removed_trials[!duplicated(removed_trials[,]),]


df_pruned <- data_WM_V3 %>%
  anti_join(removed_trials, by = c("participant" = "participant", "log_response_t1.rt" = "log_response_t1.rt",  "image_effect" = "image_effect"))

dataframe1 <- anti_join(data_WM_V3, removed_trials)

final_accuracy_summary <- dataframe1 %>%
  group_by(participant, trial_type_new) %>%
  summarize(mean_accuracy = mean(accuracy_t1, na.rm = TRUE))

objects <- removed_trials %>%
  group_by(participant,trial_type_new)%>%
  summarise(image1, image2)

objects<- objects %>% pivot_longer(cols=c('image1', 'image2'),names_to='Presentation',values_to='test1') 

# identification of ltm object pool that includes only pruned WM conditions (Test 1 and Test 2 is effected here)

data_LTM_V3 <- rbind.fill(data_LTM_V3,objects[c("participant", "test1")])

data_LTM_V3 <- data_LTM_V3 %>%
  group_by(participant)%>%
  mutate(matching = case_when(ltm_image %in% test1  ~ "Match",
                              ltm_image %notin%  test1  ~   "NO_Match"))


data_LTM_V3 <- data_LTM_V3[rowSums(is.na(data_LTM_V3)) == 1|rowSums(is.na(data_LTM_V3)) == 2|rowSums(is.na(data_LTM_V3)) == 3|rowSums(is.na(data_LTM_V3)) == 4,]

# delete all matching trials in ltm dataframe
data_LTM_pruned_V3<-data_LTM_V3[!(data_LTM_V3$matching=="Match"),]




# WM Bias in pruned data

# extract data for WM bias in attended over participants
test_2_data2_V3 <- subset(data_LTM_pruned_V3, trial_type == "attended", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))

test_2_data_WM2_V3 <- subset(data_WM_V3, trial_type_new == "attended", select = c("participant","test1","ori_t1_corrected"))

test_2_data2_V3 <- rbind.fill(test_2_data2_V3,test_2_data_WM2_V3[c("participant","test1","ori_t1_corrected")])

test2_trials2_V3 <-split(test_2_data2_V3,test_2_data2_V3$participant)

for(df in 1:length(test2_trials2_V3)) {
  test2_trials2_V3[[df]]$alternative_memory_V3 <- sapply(test2_trials2_V3[[df]]$ltm_image,function(x) test2_trials2_V3[[df]]$ori_t1_corrected[grep(x,test2_trials2_V3[[df]]$test1)[1]])
}

test_2_data2_V3 <- rbindlist(test2_trials2_V3)

test_2_data2_V3 <- test_2_data2_V3 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory_V3))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory_V3))

test_2_data2_V3 <- transform(test_2_data2_V3, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# extract data for WM bias in unattended over participants

test_1_data2_V3 <- subset(data_LTM_pruned_V3, trial_type == "unattended", select = c("participant","ltm_image","this_ori_ltm","ori_ltm"))

test_1_data_WM2_V3 <- subset(data_WM_V3, trial_type_new == "unattended", select = c("participant","test1","ori_t1_corrected"))

test_1_data2_V3 <- rbind.fill(test_1_data2_V3,test_1_data_WM2_V3[c("participant","test1","ori_t1_corrected")])

test1_trials2_V3 <-split(test_1_data2_V3,test_1_data2_V3$participant)

for(df in 1:length(test1_trials2_V3)) {
  test1_trials2_V3[[df]]$alternative_memory_V3 <- sapply(test1_trials2_V3[[df]]$ltm_image,function(x) test1_trials2_V3[[df]]$ori_t1_corrected[grep(x,test1_trials2_V3[[df]]$test1)[1]])
}


test_1_data2_V3 <- rbindlist(test1_trials2_V3)


test_1_data2_V3 <- test_1_data2_V3 %>% 
  rowwise() %>%
  mutate(min_angle_ltm = abs(ori_ltm - alternative_memory_V3))%>%
  mutate(max_angle_ltm = 360-abs(ori_ltm - alternative_memory_V3))

test_1_data2_V3 <- transform(test_1_data2_V3, accuracy_ltm = pmin(min_angle_ltm, max_angle_ltm))#angular difference

# add trials type 
test_1_data2_V3$trial_type <- "unattended"
test_2_data2_V3$trial_type <- "attended"

alternative_ltm_V3_pruned <- rbind(test_1_data2_V3,test_2_data2_V3)

summary_stats_participant_WB_V3_p <- summarySE(alternative_ltm_V3_pruned, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)
summary_study_level_WB_V3_p <- summarySE(alternative_ltm_V3_pruned, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)

```

<br>
<br>
<br>

### Pruned LTM performance

<br>
<br>
<br>
```{r accuracy LTM trial type PRUNED RIDER3, echo=FALSE,out.width="130%"}

summary_stats_participant_LTM_p_V3 <- summarySE(data_LTM_pruned_V3, measurevar = "accuracy_ltm", groupvars = c("trial_type","participant"),na.rm = T)

summary_study_level_LTM_p_V3 <- summarySE(summary_stats_participant_LTM_p_V3, measurevar = "accuracy_ltm", groupvars = c("trial_type"),na.rm = T)


summary_study_level_LTM_p_V3$participant <- 1
summary_study_level_WB_V3_p$participant <- 1

summary_stats_participant_LTM_p_V3$participant <- factor(summary_stats_participant_LTM_p_V3$participant)
summary_study_level_LTM_p_V3$participant <- factor(summary_study_level_LTM_p_V3$participant)
summary_study_level_WB_V3_p$participant <- factor(summary_study_level_WB_V3_p$participant)



prunedV3 <- ggplot(data = summary_stats_participant_LTM_p_V3, aes(x = factor(trial_type,level = level_order10), y = accuracy_ltm, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "D") +
  theme_light() +
  geom_point(data = summary_study_level_LTM_p_V3, aes(x = trial_type, y = accuracy_ltm),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_LTM_p_V3, aes(x = trial_type, ymin = accuracy_ltm - se, ymax = accuracy_ltm + se), width = 0.15, colour = "black", size = 0.8)+geom_line(data = summary_study_level_LTM_p_V3, aes(x = trial_type, group = 1), colour = "grey", size = 0.5) +
  geom_errorbar(data = summary_study_level_WB_V3_p, aes(x = trial_type, ymin = accuracy_ltm-se, ymax =accuracy_ltm+se), width = .15, colour = "orange", size = 0.8)+
  geom_line(data = summary_study_level_WB_V3_p, aes(x = trial_type, group = 1),  colour = "orange", size =0.6 )+
  scale_y_reverse()+
  ylim(c(115,0)) +theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "Experimental condition"  # Add a new x-axis title at the bottom
  ) +
  ylab("Angular difference (in °)") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type), y = accuracy_ltm, fill = factor(trial_type)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#0571B0")+geom_vline(xintercept=2.8)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "white", fill=NA, size=1))


prunedV3 <- prunedV3 +
  annotate("text", x = 0.5, y = 5, hjust = 0, vjust = 0,
           label = "grey = difference to presentation orientation", size = 3.5, color = "grey") +
  annotate("text", x = 0.5, y = 10, hjust = 0, vjust = 0,
           label = "orange = difference to WM report", size = 3.5, color = "orange")


summary_stats_participant_trial_type_V3 <- summarySE(df_pruned, measurevar = "accuracy_t1", groupvars = c("trial_type_new","participant"),na.rm = T)
summary_study_level_trial_type_V3 <- summarySE(summary_stats_participant_trial_type_V3, measurevar = "accuracy_t1", groupvars = c("trial_type_new"),na.rm = T)
summary_study_level_trial_type_V3$participant <- 1

# Convert 'participant' to a factor explicitly
summary_stats_participant_trial_type_V3$participant <- factor(summary_stats_participant_trial_type_V3$participant)
summary_study_level_trial_type_V3$participant <- factor(summary_study_level_trial_type_V3$participant)


WM_after_pruning <- ggplot(data = summary_stats_participant_trial_type_V3, aes(x = factor(trial_type_new), y = accuracy_t1, fill = participant)) +
  geom_point(position = position_dodge(width = 0.15), alpha = 0.3, shape = 21, color = "black", size = 2.2) +
  scale_fill_viridis(discrete = TRUE, guide = FALSE, option = "C") +
  theme_light()+
  geom_point(data = summary_study_level_trial_type_V3, aes(x = trial_type_new, y = accuracy_t1),  colour = "black", size = 2) +
  geom_errorbar(data = summary_study_level_trial_type_V3, aes(x = trial_type_new, ymin = accuracy_t1 - se, ymax = accuracy_t1 + se), width = 0.15, colour = "black", size = 0.8) +
  geom_line(data = summary_study_level_trial_type_V3, aes(x = trial_type_new, group = 1), colour = "grey", size = 0.5) +
  scale_y_reverse()+
  theme(
    legend.position = "bottom",  # Remove the default x-axis title
    plot.title = element_text(size = 12, hjust = 0.5)  # Adjust title size and center it
  ) +
  labs(
    title = "",
    x = "\n\nExperimental condition"  # Add a new x-axis title at the bottom
  )+
  ylim(c(70,-5)) +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  ylab("Angular difference (in °)\n\n") +
  xlab("") +
  geom_flat_violin(aes(x = factor(trial_type_new), y = accuracy_t1, fill = factor(trial_type_new)), alpha = 0.4, position = position_nudge(x = 0.13), fill = "#FFA500")+
  theme(
    plot.title = element_text(hjust = 0.5, size = 8),
    legend.position = "none",
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8),
    axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5), plot.background = element_rect(colour = "red", fill=NA, size=1))


ggarrange(WM_after_pruning, prunedV3, 
          labels = c("WM after pruning", "Pruned LTM"),
          ncol = 2, nrow = 1, widths = c(0.8, 1.1))

```
<br>
<br>
<br>

**Here shown are the paired t-tests after pruning:**

```{r pairwise t-test LTM pruned, echo=FALSE}
print("The following pairwise t-test tests the difference between attended, unattended and attended/unattended never tested storage in pruned LTM data")

full_data_summary_ltm_p_V3 <-data_LTM_pruned_V3 %>%
  group_by(trial_type, participant) %>%
  get_summary_stats(accuracy_ltm, type = "mean_sd")


full_data_summary_ltm_p_V3 %>%
  pairwise_t_test(
    mean ~ trial_type, paired = TRUE,
    p.adjust.method = "holm")

print("This t-tests checks the difference between attended/unattended in regard to WM report accuracy")


full_data_summary_ltm_report_V3 <-alternative_ltm_V3 %>%
  group_by(trial_type, participant) %>%
  get_summary_stats(accuracy_ltm, type = "mean_sd")


# full_data_summary_ltm_report_V3 %>%
#   pairwise_t_test(
#     mean ~ trial_type, paired = TRUE,
#     p.adjust.method = "holm")


print("pruned trials: this t-tests checks the difference between attended/unattended in regard to WM report accuracy in pruned trials")


```


#### ANOVA 1
2x2 Design of attention (attended vs. unattended) x WM vs LTM
<br>
<br>
<br>

```{r ANOVA1,echo=FALSE}

# data_LTM_pruned_V3 <- data_LTM_pruned_V3  %>% 
#   mutate(attention = case_when(
#     trial_type == "attended" ~ "attended",
#     trial_type == "unattended" ~ "unattended",
#     trial_type == "unattended-never tested" ~ "unattended",
#     trial_type == "attended-never tested" ~ "attended"))
# 
# data_LTM_pruned_V3 <- data_LTM_pruned_V3  %>% 
#   mutate(testing = case_when(
#     trial_type == "unattended-never tested" ~ "no",
#     trial_type == "attended-never tested" ~ "no",
#     trial_type == "attended" ~ "yes",
#     trial_type == "unattended" ~ "yes"))




data_LTM_pruned_V3$task <- "LTM"
data_WM_V3$task <-"WM"
df_pruned$task <- "WM"

# creating the full_data df with the pruned WM data

data_subset <- data_LTM_pruned_V3 %>%
  select(accuracy_ltm, trial_type,participant,task)

data_subset_WM <- df_pruned%>%
  select(accuracy_t1, trial_type_new,participant,task)

data_subset_new <- data_LTM_pruned_V3 %>%
  select(accuracy_ltm, trial_type,image_effect,participant,task)

data_subset_WM_new <- df_pruned%>%
  select(accuracy_t1, trial_type_new,image_effect,participant,task)

colnames(data_subset)[1] = "accuracy_t1"
colnames(data_subset)[2] = "exp_condition"
colnames(data_subset_new)[2] = "exp_condition"
colnames(data_subset_new)[1] = "accuracy_t1"
colnames(data_subset_WM)[2] = "exp_condition"
colnames(data_subset_WM_new)[2] = "exp_condition"

colnames(data_subset_new)[1] = "accuracy_t1"
colnames(data_subset_new)[3] = "stimulus_effect"
colnames(data_subset_WM_new)[3] = "stimulus_effect"

full_data <- rbind(data_subset_WM, data_subset)

full_data_new <- rbind(data_subset_WM_new, data_subset_new)

full_data<-full_data[!(full_data$exp_condition=="unattended-never tested"),]
full_data<-full_data[!(full_data$exp_condition=="attended-never tested"),]

full_data_new<-full_data_new[!(full_data_new$stimulus_effect=="Image2-attended-never tested"),]
full_data_new<-full_data_new[!(full_data_new$stimulus_effect=="Image1-attended-never tested"),]
full_data_new<-full_data_new[!(full_data_new$stimulus_effect=="Image2-unattended-never tested"),]
full_data_new<-full_data_new[!(full_data_new$stimulus_effect=="Image1-unattended-never tested"),]


full_data$participant = as.factor(full_data$participant)

summary_ltm <-full_data %>%
  group_by(task,exp_condition, participant) %>%
  get_summary_stats(accuracy_t1, type = "mean_sd")

summary_ltm_new <-full_data_new %>%
  group_by(task,exp_condition, participant,stimulus_effect) %>%
  get_summary_stats(accuracy_t1, type = "mean_sd")



print("The following ANOVA displays the results of all trial conditions (excluding never tested trials) across the two tasks")

#res.aov2 <- with(full_data,
                 #aov(accuracy_t1 ~ exp_condition * task+Error(participant)))

#summary(res.aov2,detailed = TRUE)

summary_ltm$exp_condition <- factor(summary_ltm$exp_condition)
summary_ltm$task <- factor(summary_ltm$task)

summary_ltm <- summary_ltm %>%
  mutate(exp_condition = recode(exp_condition, "Test 1" = "Test1", "Test 2" = "Test2"))

res.aov2 <- anova_test(data = summary_ltm, dv = mean, wid = participant, within = c(exp_condition, task))

get_anova_table(res.aov2)




print("The following ANOVA ncorporates the stimulus presentation as an effect as well")

#res.aov2 <- with(summary_ltm_new,
                 #aov(mean ~ exp_condition * task* stimulus_effect+Error(participant)))


#summary(res.aov2,detailed = TRUE)

summary_ltm_new$exp_condition <- factor(summary_ltm_new$exp_condition)
summary_ltm_new$task <- factor(summary_ltm_new$task)
summary_ltm_new$stimulus_effect <- factor(summary_ltm_new$stimulus_effect)


summary_ltm_new <- summary_ltm_new %>%
  mutate(stimulus_effect = recode(stimulus_effect,"Image1-attended" = "Image1attended","Image2-attended" = "Image2attended", "Image1-unattended"= "Image1unattended","Image2-unattended"= "Image2unattended"))



res.aov2 <- anova_test(data = summary_ltm_new, dv = mean, wid = participant, within = c(task,stimulus_effect))

get_anova_table(res.aov2)



# summary_data <- full_data %>%
#   group_by(participant, trial_type_new, test,image_presentation) %>%
#   summarize(mean_accuracy = mean(accuracy))



# res.aov2 <- with(full_data,
#                  aov(accuracy ~ trial_type_new + image_presentation* test))
```


#### ANOVA 2
2x2 Design of attention (attended vs. unattended) x tested vs untested -> To examine slopes between untested **attended** and untested **un**attended
First for the pruned data
<br>
<br>
<br>
```{r ANOVA2 (pruned),echo=FALSE}

## next I want to look at a 2x2 ANOVA  in regard to the slope of the testing benefit in attention vs. unattention trials

summary_ltm <-data_LTM_pruned_V3 %>%
  group_by(attention, testing, participant) %>%
  get_summary_stats(accuracy_ltm, type = "mean_sd")




# ggplot(summary_ltm, aes(x=attention, y=mean, fill = tesing)) +
#   geom_bar(stat='identity', fill="forestgreen", width = 0.7) +
#   scale_y_reverse() +  # Adjust width as needed
#   facet_wrap(~testing)



# Calculate participant means
participant_means <- data_LTM_pruned_V3 %>%
  group_by(attention, testing, participant) %>%
  summarise(participant_mean = mean(accuracy_ltm)) %>%
  ungroup()

# Calculate overall mean
overall_mean <- participant_means %>%
  group_by(attention, testing,participant) %>%
  summarise(overall_mean = mean(participant_mean))

# ggplot(participant_means, aes(x = attention, y = participant_mean, fill = testing)) +
#   geom_bar(stat = 'identity', position = position_dodge(width = 0.7), alpha = 0.2) +
#   geom_point(aes(shape = "Participant Mean"), size = 3, color = "black") +
#   geom_point(data = overall_mean, aes(y = overall_mean, shape = "Overall Mean"), size = 4, color = "black", fill = "white") +
#   scale_shape_manual(values = c("Participant Mean" = 21, "Overall Mean" = 21)) +
#   facet_wrap(~ testing) +
#   labs(title = "Participant Means and Overall Mean",
#        x = "Attention Level",
#        y = "Mean Accuracy",
#        fill = "Testing") +
#   theme_minimal() +
#   theme(legend.position = "bottom",
#         plot.title = element_text(size = 12, hjust = 0.5),
#         axis.text.x = element_text(angle = 45, hjust = 1))


res.aov <- anova_test(data = participant_means, dv = participant_mean, wid = participant, within = c(attention, testing))

get_anova_table(res.aov)


participant_means$exp_condition <- factor(participant_means$attention)
participant_means$task <- factor(participant_means$testing)

# res.aov <- anova_test(data = participant_means, dv = participant_mean, wid = participant, within = c(attention,testing))
# 
# get_anova_table(res.aov)


pwc <- participant_means %>%
  pairwise_t_test(
    participant_mean ~ attention, paired = TRUE,
    p.adjust.method = "bonferroni"
    )
pwc



summary_attention <-data_LTM_pruned_V3 %>%
  group_by(attention, participant) %>%
  get_summary_stats(accuracy_ltm, type = "mean_sd")

# pwc <- summary_attention %>%
#   pairwise_t_test(
#     mean ~ attention, paired = TRUE,
#     p.adjust.method = "bonferroni"
#     )
# pwc


# attention_diff <- data_LTM_pruned_V3 %>%
#   group_by(participant) %>%
#   summarize(mean_accuracy_attended = mean(accuracy_ltm[attention == "attended"], na.rm = TRUE),
#             mean_accuracy_unattended = mean(accuracy_ltm[attention == "unattended"], na.rm = TRUE)) %>%
#   mutate(difference = mean_accuracy_attended - mean_accuracy_unattended)

# plot_attention <- ggplot(attention_diff, aes(x = participant, y = difference)) +
#   geom_point(color = "blue") +
#   labs(title = "Difference in Mean Accuracy between Attended and Unattended Attention",
#        x = "Participant",
#        y = "Difference in Mean Accuracy") +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))

# gghistogram(attention_diff, x = "difference",y="..density..",
#             add = "mean", rug = TRUE,
#             bins= 40,
#             add_density = TRUE, ggtheme = theme_minimal(),position = position_dodge(),font.label = list(size = 15,color = "black"),palette = c("#00AFBB","#66CC99","#9999CC"))+xlab("\nAccuracy")+ylab("Density\n")+ theme(
#   legend.title = element_text(color = "darkblue", size = 16),
#   legend.text = element_text(color = "black", size = 10)
#   )+ theme(legend.position="top")
# 
# summary_attention%>%
# pairwise_t_test(mean ~ attention, paired = TRUE,p.adjust.method = "holm")


```
<br>
<br>
<br>

#### Circular correlation in RIDER3
Here I plotted the circular correlation coefficients per participant between the 4 trial conditions in LTM to visualize an alternative accuracy measure.

<br>
<br>
<br>
```{r LTM trials correlations, fig.height = 4.5, fig.width = 6,out.width="130%",fig.cap="Representation of Circular Correlation as an Alternative Accuracy Measure Between Original Object Orientation and Long-Term Memory Response Across Participants and Trial Types.", echo=FALSE}
# between original and LTM test

data_LTM_pruned_V3$fixedOri_ltm <- circular(data_LTM_pruned_V3$fixedOri_ltm, units = "degrees", rotation = "clock")
data_LTM_pruned_V3$ori_ltm <- circular(data_LTM_pruned_V3$ori_ltm, units = "degrees", rotation = "clock")


func_LTM <- function(data_LTM_pruned_V3)
{
  return(data.frame(COR = cor.circular(data_LTM_pruned_V3$fixedOri_ltm, data_LTM_pruned_V3$ori_ltm, test = TRUE)))
}

corr_fixed_LTM <- ddply(data_LTM_pruned_V3, .(trial_type, participant), func_LTM)
corr_fixed_LTM_overall <- ddply(data_LTM_pruned_V3, .(trial_type), func_LTM)

corr_fixed_LTM$participant <- as.character(corr_fixed_LTM$participant)
alternative_cor <-corr_fixed_LTM%>%group_by(trial_type)%>%summarise(mean=mean(COR.cor,na.rm = TRUE))

# plot


level_order12 <- c('attended','unattended','attended-never tested','unattended-never tested')


# Rotate x-axis labels by 45 degrees
theme_custom <- theme_minimal() +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 8, hjust = 0.5, margin = margin(b = 20)),
        axis.title.x = element_text(size = 10, margin = margin(t = 10), angle = 45, hjust = 1),
        axis.title.y = element_text(size = 8),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(size = 8),
        legend.title = element_blank(),
        legend.text = element_text(size = 8))

ggplot(corr_fixed_LTM, aes(x = factor(trial_type, level = level_order12), y = COR.cor, color = as.factor(participant))) +
  geom_point(size = 1.5, alpha = 0.7, position = position_jitter(width = 0.15)) +  # Add jitter to the points
  geom_violin(aes(group = trial_type), fill = "gray80", alpha = 0.7) +  # Add violin plot for distribution
  geom_line(data = alternative_cor, aes(x = trial_type, y = mean, group = 1),  colour = "black", size =0.5 )+
  geom_point(data = alternative_cor, aes(x = trial_type, y = mean),  colour = "black", size =1.5 ) +
  geom_text(data = alternative_cor, aes(x = trial_type, y = mean, label = round(mean, 2)),
            vjust = -1.5, size = 3, color = "black") +# Add mean correlation dots
  ylab('Correlation strength') +  # Shorten y-axis title
  xlab('') +
  guides(color = "none") +
  labs(title = 'Correlation as an alternative accuracy metric', 
       subtitle = 'cir. corr. between stimulus & LTM report (pruned data)') +
  theme_custom


# # calculate statistics for the correlations by transfering to z scores
# corr_fixed_LTM <- corr_fixed_LTM %>%
#   mutate(z_score = 0.5 * log((1 + COR.cor) / (1 - COR.cor)))
# 
# 
# 
# # Trial types for comparison
# trial_types <- c("attended", "attended-never tested", "unattended", "unattended-never tested")
# 
# full_data_summary_corr <-corr_fixed_LTM %>%
#   group_by(trial_type, participant) %>%
#   get_summary_stats(z_score, type = "mean_sd")
# 
# 
# full_data_summary_corr %>%
#   pairwise_t_test(
#     mean ~ trial_type, paired = TRUE,
#     p.adjust.method = "holm")
              


```


```{r WM calculation of of matlab datafile, echo=FALSE,results='hide',message=FALSE}


# summary_ltm_pruned1 <-data_LTM_pruned_V3 %>%
#   group_by(attention, testing, participant) %>%
#   get_summary_stats(accuracy_ltm, type = "mean_sd")
# 
# 
# summary_ltm_pruned <-data_LTM_pruned_V3 %>%
#   group_by(trial_type, participant) %>%
#   get_summary_stats(accuracy_ltm, type = "mean_sd")
# 
# 
# data_WM_V3$Stimulus <- data_WM_V3$test1
# data_WM_V3 <- select(data_WM_V3, Stimulus, accuracy_t1_rad,accuracy_t1,trial_type_new,participant)
# data_WM_V3 <- na.omit(data_WM_V3)
# 
# df_summary <- data_WM_V3 %>%
#   group_by(trial_type_new, participant) %>%
#   summarize(accuracy = mean(accuracy_t1_rad,na.rm = TRUE))
# 
# data_LTM_V3$accuracy_ltm_rad <- (apply(data_LTM_V3[,c("this_ori_ltm", "fixedOri_ltm")], 1, function(x) angdiff(x[1], x[2])$delta_rad))
# 
# colnames(data_LTM_V3)[colnames(data_LTM_V3) == "ltm_image"] <- "Stimulus"
# 
# data_WM_V3 <- left_join(data_WM_V3, data_LTM_V3, by = c("Stimulus", "participant"))
# 
# data_WM_V3 <- select(data_WM_V3, participant, trial_type_new, Stimulus, accuracy_t1_rad,accuracy_t1, accuracy_ltm_rad,accuracy_ltm)
# 
# colnames(data_WM_V3)[colnames(data_WM_V3) == "accuracy_ltm_rad"] <- "LTMreport_rad"
# colnames(data_WM_V3)[colnames(data_WM_V3) == "accuracy_t1_rad"] <- "WMreport_rad"
# colnames(data_WM_V3)[colnames(data_WM_V3) == "accuracy_ltm"] <- "LTMreport_deg"
# colnames(data_WM_V3)[colnames(data_WM_V3) == "accuracy_t1"] <- "WMreport_deg"
# 
# 
# trial_types <- unique(data_WM_V3$trial_type_new)
# 
# result <- data_LTM_V3 %>%
#   group_by(participant) %>%
#   summarize(attended_count = sum(trial_type == "unattended-never tested"))
# 
# 
# 
# 
# df_trial_type <- data_LTM_V3 %>%
#     filter(trial_type == "unattended-never tested") %>%
#     select(Stimulus,accuracy_ltm,accuracy_ltm_rad,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# 
# array_3d <- array(NA, dim = c(4, 4, n_participants))
# 
# for (i in 1:n_participants) {
#   participant_df <- filter(summary_ltm_pruned, participant == unique(summary_ltm_pruned$participant)[i])
#   for (j in 1:4) {
#     stimulus_row <- filter(participant_df, trial_type == unique(participant_df$trial_type)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$trial_type,stimulus_row$mean,stimulus_row$n,stimulus_row$sd)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# 
# array_3d[,,1]
# 
# V3_ltm_4_88 <- array_3d
# 
# df_trial_type <- data_WM_V3 %>%
#     filter(trial_type_new == "unattended") %>%
#     select(Stimulus, WMreport_rad,WMreport_deg,LTMreport_rad,LTMreport_deg,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# array_3d <- array(NA, dim = c(14, 5, n_participants))
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:14) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus,stimulus_row$WMreport_deg,stimulus_row$WMreport_rad,stimulus_row$LTMreport_deg,stimulus_row$LTMreport_rad)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_unattended <- array_3d
# 
# 
# trial_types <- unique(data_WM_V3$trial_type_new)
# 
# result <- data_WM_V3 %>%
#   group_by(participant) %>%
#   summarize(attended_count = sum(trial_type_new == "unattended"))
# 
# 
# 
# 
# df_trial_type <- data_WM_V3 %>%
#     filter(trial_type_new == "attended") %>%
#     select(Stimulus, WMreport_rad,WMreport_deg,LTMreport_rad,LTMreport_deg,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# 
# array_3d <- array(NA, dim = c(42, 5, n_participants))
# 
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:42) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus,stimulus_row$WMreport_deg,stimulus_row$WMreport_rad,stimulus_row$LTMreport_deg,stimulus_row$LTMreport_rad)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_attended <- array_3d
# 
# df_trial_type <- data_WM_V3 %>%
#     filter(trial_type_new == "unattended") %>%
#     select(Stimulus, WMreport_rad,WMreport_deg,LTMreport_rad,LTMreport_deg,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# array_3d <- array(NA, dim = c(14, 5, n_participants))
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:14) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus,stimulus_row$WMreport_deg,stimulus_row$WMreport_rad,stimulus_row$LTMreport_deg,stimulus_row$LTMreport_rad)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_unattended <- array_3d
# 
# 
# 
# 
# 
# 
# 
# # Create the 3D arrays for each trial type
# array_unattended <- array_unattended
# 
# dims <- dim(array_unattended)
# 
# # Write the arrays to .mat files
# #library(reticulate)
# #use_python("/Users/born/anaconda3/bin/python", required = T)
# 
# #np = import("numpy")
# 
# 
# #np$save("test.npy",r_to_py(array_3d))
# 
# 
# #np$save("array_ltm_unattended.npy",r_to_py(unattended))
# #np$save("array_ltm_attended.npy",r_to_py(attended))
# #np$save("array_ltm_unattended_never_tested.npy",r_to_py(unattended_never_tested))
# #np$save("array_ltm_attended_never_tested.npy",r_to_py(attended_never_tested))
# 
# #np$save("V3_ltm_4_88.npy",r_to_py(array_3d))
# 
# 
# # doing the same for mnemonic distances
# 
# df_trial_type <- df_pivoted %>%
#     filter(mnemonic_dis == "Image 2-Test 1") %>%
#     select(Stimulus, WMreport, LTMreport,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# array_3d <- array(NA, dim = c(20, 3, n_participants))
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:20) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_Image_2_Test_1 <- array_3d
# 
# df_trial_type <- df_pivoted %>%
#     filter(mnemonic_dis == "Image 1-Test 1") %>%
#     select(Stimulus, WMreport, LTMreport,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# array_3d <- array(NA, dim = c(20, 3, n_participants))
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:20) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_Image_1_Test_1 <- array_3d
# 
# df_trial_type <- df_pivoted %>%
#     filter(mnemonic_dis == "Image 2-Test 2") %>%
#     select(Stimulus, WMreport, LTMreport,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# array_3d <- array(NA, dim = c(20, 3, n_participants))
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:20) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_Image_2_Test_2 <- array_3d
# 
# 
# df_trial_type <- df_pivoted %>%
#     filter(mnemonic_dis == "Image 1-Test 2") %>%
#     select(Stimulus, WMreport, LTMreport,participant)
# 
# n_participants <- length(unique(df_trial_type$participant))
# array_3d <- array(NA, dim = c(20, 3, n_participants))
# for (i in 1:n_participants) {
#   participant_df <- filter(df_trial_type, participant == unique(df_trial_type$participant)[i])
#   for (j in 1:20) {
#     stimulus_row <- filter(participant_df, Stimulus == unique(participant_df$Stimulus)[j])
#     if (nrow(stimulus_row) > 0) {
#       array_3d[j, , i] <- c(stimulus_row$Stimulus, stimulus_row$WMreport, stimulus_row$LTMreport)
#     }
#   }
#   print(array_3d[ , , i])
# }
# 
# array_Image_1_Test_2 <- array_3d

```
<br>
<br>
<br>

#### Correlation of memory errors (circular and absolut error correlation)

<br>
<br>
<br>

```{r Correlation between Memory errors RIDER3, echo=FALSE,echo=FALSE,results='hide',out.width="130%",message=FALSE}
# I translated both these functions from the matlab library circular stats, to compare with the results of the "circular" R library.
# circ_mean <- function(alpha, w = NULL) {
#     if (is.null(w)) {
#         w <- rep(1, length(alpha))
#     }
#     r <- sum(w * exp(1i * alpha))
#     mu <- Arg(r)
#     return(mu)
# }
# 
# 
# circ_corrcc <-function(alpha1, alpha2) {
#     n <- length(alpha1)
#     alpha1_bar <- circ_mean(alpha1)
#     alpha2_bar <- circ_mean(alpha2)
#     
#     num <- sum(sin(alpha1 - alpha1_bar) * sin(alpha2 - alpha2_bar))
#     den <- sqrt(sum(sin(alpha1 - alpha1_bar)^2) * sum(sin(alpha2 - alpha2_bar)^2))
#     rho <- num / den
#     
#     l20 <- mean(sin(alpha1 - alpha1_bar)^2)
#     l02 <- mean(sin(alpha2 - alpha2_bar)^2)
#     l22 <- mean((sin(alpha1 - alpha1_bar)^2) * (sin(alpha2 - alpha2_bar)^2))
#     
#     ts <- sqrt((n * l20 * l02) / l22) * rho
#     pval <- 2 * (1 - pnorm(abs(ts)))
#     
#     return(c(rho, pval))
# }
# 
# 
# results_attended <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())
# 
# for (i in 1:dim(array_attended)[3]) {
#   # Get the second and third columns for this participant
#   col2 = as.numeric(array_attended[,2,i])
#   col3 = as.numeric(array_attended[,3,i])
#   
#   # Pass the numeric values to circ_corrcc
#   corr = circ_corrcc(col2, col3)
#   abs_error = cor(abs(col2), abs(col3),method = "pearson")
#   print(abs_error)
#   
#   # Store the results in the data frame
#   results_attended[i, "circular_corr"] <- corr[1]
#   results_attended[i,"abserror_corr"] <- cor(abs(col2), abs(col3), method = "pearson")
#   results_attended$trial_type <- "attended"
#   results_attended[i,"Participant"] <- i
# }
# 
# 
# results_unattended <- data.frame(Participant = numeric(), circular_corr = numeric(), abserror_corr = numeric())
# 
# for (i in 1:dim(array_unattended)[3]) {
#   # Get the second and third columns for this participant
#   col2 = as.numeric(array_unattended[,2,i])
#   col3 = as.numeric(array_unattended[,3,i])
#   
#   # Pass the numeric values to circ_corrcc
#   corr = circ_corrcc(col2, col3)
#   abs_error = cor(abs(col2), abs(col3),method = "pearson")
#   print(abs_error)
#   
#   # Store the results in the data frame
#   results_unattended[i, "circular_corr"] <- corr[1]
#   results_unattended[i,"abserror_corr"] <- abs_error
#   results_unattended[i,"Participant"] <- i
#   results_unattended$trial_type <- "unattended"
# }
# 
# 
# error_correlations_absolut <-rbind(results_attended,results_unattended)



# level_order_corr <- c('attended', 'unattended')
# 
# 
# 
# ggplot(error_correlations_absolut, aes(x = factor(trial_type, level = level_order_corr), y = abserror_corr)) +
# theme(legend.position = "none") +
# geom_line(aes(group = Participant), alpha = 1/5)+
# geom_point(size = 1, color = "grey") +
# geom_point(data = error_correlations_absolut %>% group_by(trial_type) %>% summarise(correlation = mean(abserror_corr,na.rm = TRUE)),
# aes(x = trial_type, y = correlation), size = 3, color = "red")+
# geom_text(data = error_correlations_absolut %>% group_by(trial_type) %>% summarise(correlation = round(mean(abserror_corr,na.rm = TRUE),2)),
# aes(x = trial_type, y = correlation, label = paste0("mean: ", correlation)),
# color = "darkred", size =4, hjust = 1.2, vjust = -0.25)+
# geom_line(data = error_correlations_absolut %>% group_by(trial_type) %>% summarise(correlation = mean(abserror_corr,na.rm = TRUE)),
# aes(x = trial_type, y = correlation), color = "red", size = 1) +
# ggtitle("Pearson correlation of absolut errors by exp. conditions") +
# xlab("Exp. condition") +
# ylab("Corr. WM-LTM") +
# theme_classic()
```

```{r Plots between Memory errors RIDER3, out.width="130%",fig.cap="", echo=FALSE}
#subset_attended <- error_correlations_absolut[error_correlations_absolut$trial_type == "attended", ]
#subset_unattended <- error_correlations_absolut[error_correlations_absolut$trial_type == "unattended", ]

#fig1 <- plot_ly(type = 'box')
#fig1 <- fig1 %>% add_boxplot(y = subset_attended$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
             # marker = list(color = 'rgb(107,174,214)'),
              #line = list(color = 'rgb(107,174,214)'),
              #name = "attended")
#fig1 <- fig1 %>% add_boxplot(y = subset_unattended$abserror_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              #marker = list(color = 'rgb(107,174,214)'),
              #line = list(color = 'rgb(107,174,214)'),
              #name = "unattended")

#fig1 <- fig1 %>% layout(title = "Pearson correlation of absolut errors by exp. conditions in WW/LTM task")

#fig1

#fig2 <- plot_ly(type = 'box')
#fig2 <- fig2 %>% add_boxplot(y = subset_attended$circular_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              #marker = list(color = 'rgb(107,174,214)'),
              #line = list(color = 'rgb(107,174,214)'),
              #name = "attended")
#fig2 <- fig2 %>% add_boxplot(y = subset_unattended$circular_corr, jitter = 0.3, pointpos = -5, boxpoints = 'all',
              #marker = list(color = 'rgb(107,174,214)'),
              #line = list(color = 'rgb(107,174,214)'),
              #name = "unattended")

#fig2 <- fig2 %>% layout(title = "Circ. correlation of signed errors in WW/LTM task")

#fig2

#s1 <- subplot(fig1, fig2)%>%  
  #layout(annotations = list( 
    #list(x = 0.15 , y = 0.95, text = "(absolut error) pearson corr.", showarrow = T, xref='paper', yref='paper'), 
    #list(x = 0.85 , y = 0.95, text = "(signed error) circ. corr.", showarrow = T, xref='paper', yref='paper')) 
 # )
#s1

```
